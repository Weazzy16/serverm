<script>
    export let onSelectedView;
    export let selectedId;
    export let selectCharData;

    let isLoad = false;//false;
    const updateLoad = () => isLoad = true;

    import { executeClientToGroup } from "api/rage";
    executeClientToGroup ("business.load", selectedId);

    import { addListernEvent } from 'api/functions';
    addListernEvent ("phoneBusinessInit", updateLoad);


    import Menu from './menu.svelte'
    import Stocks from './stock/index.svelte'
    import Orders from './orders/index.svelte'
    import Stats from './stats.svelte'

    import TopClients from './topclients.svelte'
    import TopOrders from './toporders.svelte'

    const viewsBusiness = {
        Menu,
        Stocks,
        Orders,
        Stats,
        TopClients,
        TopOrders
    }

    let selectedViewBusiness = "Menu"

    const onSelectedViewBusiness = (view) => selectedViewBusiness = view;

    const onSell = () => {
        if (!window.loaderData.delay ("business.sell", 1.5))
            return;

        executeClientToGroup ("business.sell");
        onSelectedView(mainmenu);
    }
</script>

{#if !isLoad}
    <div></div>
{:else}
<div class="mybizapp">
    <div class="mybizapp__header">
        <div class="btnhead" class:active={selectedViewBusiness === "Furniture"} on:keypress={() => {}} on:click={() => onSelectedViewBusiness("Menu")}>
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0_129_89)">
                <path d="M5.6665 7.167H1.5C0.673 7.167 0 6.494 0 5.667V1.5C0 0.673 0.673 0 1.5 0H5.6665C6.4935 0 7.1665 0.673 7.1665 1.5V5.667C7.1665 6.494 6.494 7.167 5.6665 7.167ZM14.5 7.167H10.333C9.506 7.167 8.833 6.494 8.833 5.667V1.5C8.833 0.673 9.506 0 10.333 0H14.5C15.327 0 16 0.673 16 1.5V5.667C16 6.494 15.327 7.167 14.5 7.167ZM5.6665 15.969H1.5C0.673 15.969 0 15.296 0 14.469V10.302C0 9.475 0.673 8.802 1.5 8.802H5.6665C6.4935 8.802 7.1665 9.475 7.1665 10.302V14.469C7.1665 15.296 6.494 15.969 5.6665 15.969ZM14.5 15.969H10.333C9.506 15.969 8.833 15.296 8.833 14.469V10.302C8.833 9.475 9.506 8.802 10.333 8.802H14.5C15.327 8.802 16 9.475 16 10.302V14.469C16 15.296 15.327 15.969 14.5 15.969Z"/>
                </g>
                <defs>
                <clipPath id="clip0_129_89">
                <rect width="16" height="16" fill="white"/>
                </clipPath>
                </defs>
            </svg>                
            <p>Главная</p>
        </div>
        <div class="btnhead" class:active={selectedViewBusiness === "Furniture"} on:keypress={() => {}} on:click={() => onSelectedViewBusiness("Stocks")}>
            <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0_129_92)">
                <path d="M13.1429 5.87362V15.2002L15.9258 12.6859C15.9739 12.6335 16.0005 12.5648 16 12.4936V2.56334L13.0572 5.50618C13.1132 5.6206 13.1425 5.74623 13.1429 5.87362ZM5.14291 9.27906L6.10719 8.50762C6.15787 8.46705 6.22085 8.44495 6.28577 8.44495C6.35068 8.44495 6.41366 8.46705 6.46434 8.50762L7.42863 9.27906V5.58793H5.14291V9.27906ZM1.14291 13.5879H5.71434V14.7308H1.14291V13.5879ZM7.59606 5.0165L10.9409 1.67162C11.3281 1.2393 11.5775 0.701307 11.6572 0.126465L10.7186 0.689902C10.6699 0.719175 10.6136 0.733262 10.5569 0.730361C10.5001 0.727461 10.4455 0.707706 10.4001 0.673621L9.67122 0.126777C9.51638 1.04706 8.97466 1.58793 8.48778 2.07562L5.54694 5.01646H7.59606V5.0165ZM7.59606 2.15934H3.38006C3.34212 2.15938 3.30456 2.16699 3.26958 2.1817C3.2346 2.19642 3.20291 2.21796 3.17634 2.24506L0.675781 5.0165H4.73894L7.59606 2.15934ZM11.2612 2.15934L8.40406 5.0165H12.2858C12.4131 5.017 12.5386 5.04628 12.6529 5.10221L15.5961 2.15937L11.2612 2.15934Z"/>
                <path d="M0.285719 15.8736H12.2857C12.3232 15.8736 12.3604 15.8662 12.3951 15.8519C12.4297 15.8375 12.4612 15.8165 12.4878 15.7899C12.5143 15.7634 12.5353 15.7319 12.5497 15.6972C12.564 15.6626 12.5714 15.6254 12.5714 15.5879V5.87361C12.5714 5.83609 12.564 5.79893 12.5497 5.76427C12.5353 5.7296 12.5143 5.69811 12.4878 5.67158C12.4612 5.64504 12.4297 5.624 12.3951 5.60964C12.3604 5.59528 12.3232 5.58789 12.2857 5.58789H8V9.87361C8.00002 9.92745 7.98483 9.98019 7.95618 10.0258C7.92753 10.0714 7.88658 10.1079 7.83806 10.1312C7.78953 10.1546 7.73541 10.1637 7.68192 10.1576C7.62843 10.1515 7.57775 10.1304 7.53572 10.0968L6.28572 9.09677L5.03572 10.0968C4.99369 10.1304 4.94301 10.1515 4.88952 10.1576C4.83604 10.1637 4.78192 10.1545 4.7334 10.1312C4.68488 10.1079 4.64394 10.0713 4.61528 10.0258C4.58663 9.98018 4.57143 9.92744 4.57144 9.87361V5.58792H0.285719C0.210809 5.58817 0.138992 5.61782 0.0857187 5.67048L0.0817187 5.67505C0.0294755 5.72794 0.000124648 5.79926 1.70949e-09 5.87361V15.5879C-4.1029e-06 15.6254 0.00738343 15.6626 0.0217407 15.6972C0.0360979 15.7319 0.0571437 15.7634 0.0836759 15.7899C0.110208 15.8165 0.141707 15.8375 0.176374 15.8519C0.211041 15.8662 0.248196 15.8736 0.285719 15.8736ZM10.3694 13.6716L10.9409 13.1002C10.9945 13.0466 11.0671 13.0165 11.1429 13.0165C11.2186 13.0165 11.2913 13.0466 11.3449 13.1002L11.9163 13.6716C11.9431 13.6981 11.9644 13.7296 11.979 13.7643C11.9936 13.799 12.0011 13.8363 12.0012 13.874C12.0013 13.9116 11.994 13.949 11.9797 13.9838C11.9653 14.0186 11.9442 14.0502 11.9176 14.0769C11.8909 14.1035 11.8593 14.1246 11.8245 14.139C11.7897 14.1533 11.7523 14.1607 11.7147 14.1605C11.677 14.1604 11.6398 14.1529 11.605 14.1383C11.5703 14.1237 11.5388 14.1024 11.5123 14.0756L11.4286 13.9919V14.1594C11.4286 14.2351 11.3985 14.3078 11.3449 14.3614C11.2913 14.415 11.2187 14.4451 11.1429 14.4451C11.0671 14.4451 10.9944 14.415 10.9408 14.3614C10.8873 14.3078 10.8572 14.2351 10.8572 14.1594V13.9919L10.7734 14.0756C10.7195 14.1273 10.6474 14.1558 10.5727 14.155C10.498 14.1541 10.4266 14.1241 10.3738 14.0713C10.321 14.0184 10.2909 13.947 10.2901 13.8723C10.2893 13.7976 10.3178 13.7256 10.3694 13.6716ZM10.5714 14.7308H11.7143C11.7901 14.7308 11.8627 14.7609 11.9163 14.8145C11.9699 14.868 12 14.9407 12 15.0165C12 15.0923 11.9699 15.1649 11.9163 15.2185C11.8627 15.2721 11.7901 15.3022 11.7143 15.3022H10.5714C10.4957 15.3022 10.423 15.2721 10.3694 15.2185C10.3158 15.1649 10.2857 15.0923 10.2857 15.0165C10.2857 14.9407 10.3158 14.868 10.3694 14.8145C10.423 14.7609 10.4957 14.7308 10.5714 14.7308ZM0.571437 13.5879C0.571437 13.2723 0.827281 13.0165 1.14287 13.0165H5.71431C6.02991 13.0165 6.28575 13.2723 6.28575 13.5879V14.7308C6.28575 15.0464 6.02991 15.3022 5.71431 15.3022H1.14284C0.82725 15.3022 0.571406 15.0464 0.571406 14.7308L0.571437 13.5879Z"/>
                </g>
                <defs>
                <clipPath id="clip0_129_92">
                <rect width="16" height="16" fill="white"/>
                </clipPath>
                </defs>
            </svg>                              
            <p>Товары</p>
        </div>
        <div class="btnhead" on:keypress={() => {}} on:click={onSell}>
            <p>Продать Бизнес</p>
        </div>
        <h1>Бизнес #{selectCharData.BizId}</h1>
        <div class="appiconhead">
            <img src="http://cdn.magicfive.ru/haxzer/ipad/mybiz.png" alt=""/>
        </div>
        <div class="clossed">
            <p>X</p>
        </div>   
    </div>
    <svelte:component this={viewsBusiness[selectedViewBusiness]} {selectCharData} {onSelectedView} {selectedId} {onSelectedViewBusiness} />
</div>
{/if}
