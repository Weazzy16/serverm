<script>
    import { onDestroy } from 'svelte';
    import { hasJsonStructure, addListernEvent } from "api/functions";
    import { executeClientToGroup, executeClient, executeClientAsyncToGroup } from "api/rage";
    import Menu from './menu.svelte';
    import Upgrade from './upgrade.svelte';
    import Furniture from './furniture.svelte';
    import Residents from './resident.svelte';
    export let selectedId;
    export let onSelectedView;
    export let selectCharData;


    let isLoad = false;
    const updateLoad = () => isLoad = true;

    executeClientToGroup ("house.load");

    addListernEvent ("phoneHouseInit", updateLoad);

    let houseData = {}
    executeClientAsyncToGroup("house.houseData").then((result) => {
        if (hasJsonStructure(result))
            houseData = JSON.parse(result);
    });


    const viewsHouse = {
        Menu,
        Upgrade,
        Furniture,
        Residents
    }

    let selectedViewHouse = "Menu"

    const onSelectedViewHouse = (view) => selectedViewHouse = view;

    onDestroy(() => {
        executeClient ("client.phone.house.close");
    });
</script>
{#if !isLoad}
    <div></div>
{:else}
    <div class="myhomeapp">
        <div class="myhomeapp__header">
            <svg width="22" height="22" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                <g clip-path="url(#clip0_113_4)">
                <path d="M21.7244 10.7424C21.8191 10.639 21.8921 10.5178 21.9392 10.3858C21.9862 10.2537 22.0064 10.1136 21.9983 9.97366C21.9903 9.83373 21.9543 9.69682 21.8925 9.57103C21.8307 9.44523 21.7443 9.3331 21.6384 9.24126L11.8063 0.638124C11.3601 0.247855 10.6446 0.25603 10.2077 0.656555L0.342163 9.69994C-0.0947204 10.1005 -0.116163 10.7719 0.294688 11.1989L0.542031 11.4565C0.95238 11.8836 1.61566 11.9345 2.02257 11.5699L2.75987 10.9096V20.5761C2.75987 21.1692 3.24042 21.6493 3.83307 21.6493H7.67868C8.27132 21.6493 8.75188 21.1692 8.75188 20.5761V13.8135H13.657V20.5761C13.6485 21.1688 14.0725 21.6489 14.6652 21.6489H18.7405C19.3332 21.6489 19.8137 21.1688 19.8137 20.5757V11.0457C19.8137 11.0457 20.0174 11.2242 20.2686 11.445C20.5194 11.6653 21.0461 11.4886 21.4449 11.0496L21.7244 10.7424Z" fill="#FCC042"/>
                </g>
                <defs>
                <clipPath id="clip0_113_4">
                <rect width="22" height="22" fill="white"/>
                </clipPath>
                </defs>
            </svg> 
            <h1>Дом #{selectCharData.houseId}</h1>
            <div class="btnmyhome" class:active={selectedViewHouse === "Menu"} on:keypress={() => {}} on:click={() => onSelectedViewHouse("Menu")}>
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip0_113_14)">
                    <path d="M13.8246 6.83603C13.8849 6.77027 13.9314 6.6931 13.9613 6.60908C13.9912 6.52506 14.004 6.43589 13.9989 6.34684C13.9938 6.25779 13.9709 6.17067 13.9316 6.09062C13.8923 6.01057 13.8373 5.93921 13.7699 5.88076L7.51312 0.406046C7.22913 0.157693 6.77381 0.162895 6.4958 0.417774L0.21774 6.17266C-0.0602766 6.42753 -0.0739219 6.85478 0.187529 7.12655L0.344929 7.29047C0.60606 7.56224 1.02815 7.59464 1.28709 7.36262L1.75628 6.94245V13.0939C1.75628 13.4713 2.06209 13.7768 2.43923 13.7768H4.88643C5.26357 13.7768 5.56938 13.4713 5.56938 13.0939V8.79036H8.69081V13.0939C8.68538 13.471 8.95523 13.7765 9.33237 13.7765H11.9258C12.3029 13.7765 12.6087 13.471 12.6087 13.0936V7.02907C12.6087 7.02907 12.7383 7.14261 12.8982 7.28312C13.0578 7.42337 13.393 7.31092 13.6468 7.03153L13.8246 6.83603Z"/>
                    </g>
                    <defs>
                    <clipPath id="clip0_113_14">
                    <rect width="14" height="14" fill="white"/>
                    </clipPath>
                    </defs>
                </svg>
                <p>Главная</p>                
            </div>
            <div class="btnmyhome" class:active={selectedViewHouse === "Upgrade"} on:keypress={() => {}} on:click={() => onSelectedViewHouse("Upgrade")}>
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip0_113_21)">
                    <path d="M7.74554 6.71108C7.90884 6.62779 8.08961 6.58457 8.27292 6.58499C8.42484 6.58458 8.57534 6.61421 8.71577 6.67217C8.8562 6.73012 8.98379 6.81527 9.0912 6.92271L9.5625 6.45145C10.7288 6.86028 12.0778 6.59855 13.0101 5.66622C13.7947 4.88171 14.104 3.80232 13.9389 2.78487C13.93 2.72993 13.9061 2.67851 13.8698 2.63628C13.8336 2.59405 13.7863 2.56265 13.7334 2.54555C13.6804 2.52839 13.6237 2.5262 13.5696 2.53921C13.5155 2.55222 13.466 2.57994 13.4266 2.61929L12.7268 3.31908C12.1569 3.88895 11.2329 3.88895 10.663 3.31908C10.0931 2.7492 10.0931 1.82517 10.663 1.2553L11.3628 0.555508C11.4022 0.516128 11.4299 0.466643 11.443 0.412508C11.456 0.358373 11.4538 0.30169 11.4367 0.248709C11.4196 0.195727 11.3881 0.148505 11.3459 0.112248C11.3036 0.0759901 11.2522 0.052106 11.1972 0.0432281C10.1798 -0.121928 9.10037 0.187465 8.3159 0.97198C7.36967 1.91821 7.11501 3.29333 7.5502 4.47135L6.52803 5.49352L7.74554 6.71108ZM5.88288 8.56333L4.67048 7.35093L0.431017 11.5903C-0.120235 12.1416 -0.120235 13.0353 0.431017 13.5866C0.982269 14.1378 1.87601 14.1378 2.42726 13.5866L6.08195 9.93195C5.71333 9.56138 5.6469 9.00191 5.88288 8.56333Z"/>
                    <path d="M8.58666 7.43139C8.49997 7.34471 8.3863 7.30134 8.27268 7.30134C8.15906 7.30134 8.04539 7.34471 7.9587 7.43139L7.70562 7.68448L3.19741 3.17626L3.40813 2.96555C3.60012 2.7736 3.57629 2.45518 3.35745 2.29403L1.5181 0.9394C1.43257 0.876414 1.3273 0.846173 1.22138 0.854164C1.11547 0.862156 1.01593 0.907851 0.940818 0.982957L0.159837 1.76399C0.0847307 1.83909 0.0390361 1.93864 0.0310444 2.04455C0.0230527 2.15047 0.0532935 2.25574 0.11628 2.34127L1.47086 4.18062C1.63201 4.39941 1.95024 4.42348 2.14238 4.2313L2.3531 4.02053L6.86131 8.52874L6.59041 8.79964C6.54918 8.84087 6.51647 8.88982 6.49416 8.94369C6.47184 8.99756 6.46036 9.05531 6.46036 9.11362C6.46036 9.17193 6.47184 9.22967 6.49416 9.28354C6.51647 9.33741 6.54918 9.38636 6.59041 9.42759L10.7494 13.5865C11.3006 14.1378 12.1943 14.1378 12.7456 13.5865C13.2969 13.0353 13.2969 12.1415 12.7456 11.5903L8.58666 7.43139Z"/>
                    </g>
                    <defs>
                    <clipPath id="clip0_113_21">
                    <rect width="14" height="14" fill="white"/>
                    </clipPath>
                    </defs>
                </svg>                
                <p>Улучшения</p>                
            </div>
            <div class="btnmyhome" class:active={selectedViewHouse === "Furniture"} on:keypress={() => {}} on:click={() => onSelectedViewHouse("Furniture")}>
                <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <g clip-path="url(#clip0_129_84)">
                    <path d="M5.76814 0H13.9346V1.06797H5.76814V0ZM0.89992 8.95977H7.76816L7.98451 7.01802C7.98993 6.95191 7.98191 6.88538 7.96094 6.82245C7.93996 6.75952 7.90646 6.70149 7.86245 6.65186C7.73486 6.51039 7.54069 6.42995 7.32987 6.42995H1.33819C1.12737 6.42995 0.933197 6.51039 0.808358 6.65186C0.716819 6.75171 0.669671 6.88486 0.683542 7.01802L0.89992 8.95977Z" fill="black"/>
                    <path d="M8.10932 6.42999C8.26465 6.59919 8.33954 6.82666 8.31458 7.05411L8.14537 8.58809H9.68491V1.40087H5.76811V6.09713H7.32983C7.63497 6.09713 7.92068 6.21916 8.10932 6.42999ZM8.65022 4.01113H8.9831V5.21779H8.65022V4.01113ZM10.0178 8.58811H13.9345V1.40087H10.0178V8.58811ZM10.8 4.01113H11.1329V5.21779H10.8V4.01113ZM3.63497 1.12903H1.60446L1.31875 3.09018H3.92068L3.63497 1.12903ZM0.716808 13.6672H1.15232L1.36589 12.9848H0.716808V13.6672ZM8.09822 9.01529C8.40058 9.10961 8.65855 9.31765 8.81667 9.59226V9.44524H10.7251V9.77812H8.90265C8.95572 9.91719 8.98298 10.0648 8.9831 10.2136V10.6158C8.9831 10.749 8.93039 10.8766 8.83885 10.9737C8.90821 11.0486 8.95535 11.1429 8.97478 11.2427H13.9346V8.92097H8.10932L8.09822 9.01529ZM8.65022 12.4605V11.3315C8.65022 11.2261 8.56423 11.1401 8.45882 11.1401H0.256333C0.150923 11.1401 0.0649414 11.2261 0.0649414 11.3315V12.4605C0.0649414 12.5659 0.150923 12.6519 0.256333 12.6519H8.45604C8.56145 12.6547 8.64744 12.5687 8.65022 12.4633V12.4605Z"/>
                    <path d="M8.98312 12.2885H10.7251V12.6214H8.95815C8.88602 12.8378 8.68354 12.9848 8.45607 12.9848H8.4422V13.7032H13.9346V11.5756H8.98312V12.2885ZM5.76813 12.9848V13.7032H7.33819L7.1135 12.9848H5.76813ZM7.67661 13.6671H8.10934V12.9848H7.46023L7.67661 13.6671ZM0.256356 10.8072H8.45885C8.56426 10.8072 8.65024 10.7212 8.65024 10.6158V10.2136C8.65024 9.70599 8.23693 9.29266 7.72929 9.29266H0.98589C0.478268 9.29266 0.0649414 9.70597 0.0649414 10.2136V10.6158C0.0649644 10.7212 0.150946 10.8072 0.256356 10.8072ZM2.4533 3.25659H2.78618V6.09708H2.4533V3.25659ZM2.78618 12.9848H2.4533V13.6671H1.92624V14H3.37702V13.6671H2.78618V12.9848Z"/>
                    </g>
                    <defs>
                    <clipPath id="clip0_129_84">
                    <rect width="14" height="14" fill="white"/>
                    </clipPath>
                    </defs>
                </svg>                              
                <p>Мебель</p>                
            </div>
            <div class="myhomeinfo">
                <p>{selectCharData.Name} {#if houseData.isOwner}(Owner){/if}</p>
                <span>Дом №{selectCharData.houseId}</span>
            </div>
            <div class="appiconhead">
                <img src="http://cdn.magicfive.ru/haxzer/ipad/myhome.png" alt=""/>
            </div>
            <div class="clossed" on:keypress={() => {}} on:click={() => onDestroy()}>
                <p>X</p>
            </div>            
        </div>
        <svelte:component this={viewsHouse[selectedViewHouse]} {onSelectedView} {selectCharData} {selectedId} {onSelectedViewHouse} />
    </div>
{/if}