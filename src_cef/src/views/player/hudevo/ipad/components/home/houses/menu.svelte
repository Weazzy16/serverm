<script>
    import { translateText } from 'lang'
    import { executeClientToGroup, executeClient, executeClientAsyncToGroup } from 'api/rage'
    import { format } from 'api/formatter'
    import { hasJsonStructure } from "api/functions";
    import { TimeFormat } from 'api/moment'

    let replacements = [
        { word: 'Трейлер', replacement: '1' },
        { word: 'Эконом', replacement: '2' },
        { word: 'Эконом+', replacement: '3' },
        { word: 'Комфорт', replacement: '4' },
        { word: 'Комфорт+', replacement: '5' },
        { word: 'Премиум', replacement: '6' },
        { word: 'Премиум+', replacement: '7' },
        { word: 'Парковка', replacement: '0' },
        { word: 'Премиум++', replacement: '15' },
        { word: 'Люкс', replacement: '30' },
    ];

    let menuAccess = []
    executeClientAsyncToGroup("house.getStats").then((result) => {
        if (hasJsonStructure(result))
            menuAccess = JSON.parse(result);
    });

    let houseData = {}
    executeClientAsyncToGroup("house.houseData").then((result) => {
        if (hasJsonStructure(result))
            houseData = JSON.parse(result);
    });

    let residentsCount = 0;
    executeClientAsyncToGroup("house.residentsData").then((result) => {
        if (hasJsonStructure(result)) {
            result = JSON.parse(result);
            residentsCount = Object.keys (result).length;
        }
    });

    const onAction = (text) => {
        if (!window.loaderData.delay ("house.action", 1.5))
            return;

        executeClientToGroup ("house.action", text)
    }

    const onOpenPark = () => {
        executeClientToGroup ("house.openPark");
    }

    let residentsData = []
    executeClientAsyncToGroup("house.residentsData").then((result) => {
        if (hasJsonStructure(result))
            residentsData = JSON.parse(result);
    });

    export let onSelectedViewHouse;
    export let onSelectedView;
    export let selectedId;
    export let selectCharData;
</script>

<div class="menuhyhome">
    <div class="leftmenu">
        <div class="menuheader">
            <img src="http://cdn.magicfive.ru/haxzer/house/house {selectCharData.houseId}.png" alt=""/>
        </div>
        <div class="infomenu">
            <div class="gpsinfo">
                <svg width="48" height="48" viewBox="0 0 48 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <rect width="48" height="48" rx="24" fill="#292929" fill-opacity="0.04"/>
                    <path d="M24.0001 14.1033C19.8143 14.1033 16.4089 17.4288 16.4089 21.5163C16.4089 25.4939 22.7219 33.085 22.9907 33.4064C23.2514 33.7178 23.6194 33.8965 24.0002 33.8965C24.3811 33.8965 24.7491 33.7178 25.0097 33.4062C25.2784 33.085 31.5914 25.4939 31.5914 21.5163C31.5912 17.4288 28.1858 14.1033 24.0001 14.1033ZM21.2196 21.5163C21.2196 20.0159 22.4669 18.7955 24.0001 18.7955C25.5332 18.7955 26.7807 20.0159 26.7807 21.5163C26.7807 23.0166 25.5332 24.2375 24.0001 24.2375C22.4669 24.2375 21.2196 23.0166 21.2196 21.5163Z" fill="#FCC042" fill-opacity="0.7"/>
                </svg>
                <div class="infohome">
                    <p>Улица</p>
                    <b>{houseData.area}</b>
                </div>                        
            </div>
            <div class="priceinfo">
                <p>${format("money", houseData.price)} $</p>
                <b>Гос. цена:</b>
            </div>
        </div>
        <div class="infomenu">
            <div class="infoblock">
                <p>
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <g clip-path="url(#clip0_119_68)">
                        <path d="M19.9532 7.1184L19.2376 8.29184C19.2093 8.33799 19.1695 8.37604 19.1221 8.40232C19.0748 8.4286 19.0214 8.44221 18.9673 8.44184C18.9112 8.44193 18.8561 8.42681 18.8079 8.39809L9.99213 3.18075L1.17494 8.39809C1.13923 8.41922 1.09971 8.4331 1.05863 8.43895C1.01755 8.44481 0.975716 8.44251 0.935525 8.43219C0.895334 8.42188 0.857568 8.40374 0.824385 8.37883C0.791202 8.35392 0.763252 8.32271 0.74213 8.287L0.0436926 7.10278C0.00161665 7.03094 -0.0104972 6.94543 0.00996972 6.86473C0.0304367 6.78403 0.0818401 6.71463 0.153068 6.67153L9.74682 0.901214C9.82035 0.856754 9.90464 0.833252 9.99057 0.833252C10.0765 0.833252 10.1608 0.856754 10.2343 0.901214L19.8468 6.68403C19.8825 6.70543 19.9135 6.73368 19.9382 6.76716C19.9629 6.80064 19.9806 6.83867 19.9905 6.87906C20.0004 6.91945 20.0022 6.9614 19.9957 7.00248C19.9893 7.04356 19.975 7.08296 19.9532 7.1184Z" fill="#FCC042"/>
                        <path d="M18.1234 8.35571V18.8526C18.1233 18.894 18.1151 18.9349 18.0992 18.9731C18.0833 19.0113 18.0601 19.0459 18.0307 19.0751C18.0014 19.1043 17.9666 19.1274 17.9284 19.1431C17.8901 19.1588 17.8491 19.1668 17.8078 19.1667H16.1251C16.0416 19.1667 15.9615 19.1337 15.9024 19.0748C15.8432 19.016 15.8098 18.9361 15.8095 18.8526V8.65728L4.17353 8.65431L4.17197 18.8526C4.17164 18.9361 4.13823 19.016 4.07907 19.0748C4.0199 19.1337 3.93981 19.1667 3.85635 19.1667H2.17197C2.13072 19.1667 2.08987 19.1586 2.05176 19.1428C2.01365 19.127 1.97902 19.1039 1.94985 19.0747C1.92068 19.0455 1.89755 19.0109 1.88177 18.9728C1.866 18.9347 1.85789 18.8938 1.85791 18.8526V8.35728L9.99229 3.54321L18.1234 8.35571Z" fill="#FCC042"/>
                        <path d="M15.4969 8.96977V9.76352H4.48438V8.9668L15.4969 8.96977ZM4.48438 10.076H15.4969V10.8745H4.48438V10.076ZM7.91562 18.5323V18.7385C7.91558 18.8518 7.87068 18.9604 7.79074 19.0407C7.71079 19.1209 7.60232 19.1662 7.48906 19.1666H6.39844C6.34232 19.1665 6.28677 19.1554 6.23496 19.1338C6.18315 19.1122 6.1361 19.0807 6.09649 19.0409C6.05688 19.0012 6.02549 18.954 6.00411 18.9021C5.98272 18.8502 5.97177 18.7946 5.97188 18.7385V18.5229C6.01009 18.5293 6.04876 18.5324 6.0875 18.5323H7.91562ZM14.0094 18.5229V18.7385C14.0093 18.8518 13.9644 18.9604 13.8845 19.0407C13.8045 19.1209 13.6961 19.1662 13.5828 19.1666H12.4766C12.3633 19.1662 12.2548 19.1209 12.1749 19.0407C12.0949 18.9604 12.05 18.8518 12.05 18.7385V18.5323H13.8937C13.9325 18.5324 13.9712 18.5293 14.0094 18.5229ZM8.97891 16.7037H11.002L11.1042 16.2512H8.87672L8.97891 16.7037ZM12.6761 16.0448C12.5904 16.0441 12.5064 16.069 12.4349 16.1162C12.3633 16.1633 12.3074 16.2307 12.2742 16.3097C12.2409 16.3887 12.2319 16.4758 12.2482 16.5599C12.2646 16.644 12.3055 16.7214 12.3659 16.7822C12.4263 16.8431 12.5034 16.8846 12.5874 16.9015C12.6714 16.9185 12.7586 16.9101 12.8378 16.8774C12.917 16.8448 12.9848 16.7893 13.0325 16.7181C13.0802 16.6469 13.1056 16.5631 13.1056 16.4774C13.1059 16.3631 13.0608 16.2534 12.9803 16.1723C12.8998 16.0912 12.7904 16.0453 12.6761 16.0448Z" fill="#FCC042"/>
                        <path d="M14.2906 15.449L13.7774 14.5399L13.0742 12.7165C13.0363 12.6181 12.9696 12.5334 12.8828 12.4735C12.7961 12.4135 12.6933 12.3811 12.5878 12.3804H7.39518C7.2895 12.3809 7.18643 12.4132 7.09939 12.4731C7.01235 12.533 6.94538 12.6178 6.90721 12.7163L6.2033 14.5399L5.68924 15.4508C5.62975 15.559 5.59842 15.6804 5.59814 15.8038V17.7288C5.5981 17.8587 5.64957 17.9833 5.74125 18.0752C5.83293 18.1672 5.95734 18.2191 6.08721 18.2194H13.8935C14.0233 18.2191 14.1477 18.1672 14.2394 18.0752C14.3311 17.9833 14.3826 17.8587 14.3825 17.7288V15.8038C14.3821 15.6797 14.3505 15.5577 14.2906 15.449ZM7.11971 14.5754L7.59643 13.2219C7.60717 13.1914 7.62714 13.165 7.65356 13.1463C7.67998 13.1276 7.71156 13.1175 7.74393 13.1176H12.2371C12.2694 13.1175 12.301 13.1276 12.3274 13.1463C12.3538 13.165 12.3738 13.1914 12.3846 13.2219L12.8613 14.5754C12.8696 14.5989 12.8721 14.6242 12.8686 14.6489C12.8652 14.6737 12.8558 14.6972 12.8414 14.7176C12.8269 14.738 12.8078 14.7546 12.7856 14.7661C12.7634 14.7775 12.7388 14.7835 12.7138 14.7835H7.26705C7.24208 14.7835 7.21747 14.7775 7.19529 14.766C7.17311 14.7545 7.154 14.7379 7.13957 14.7175C7.12514 14.6971 7.1158 14.6736 7.11235 14.6489C7.10889 14.6241 7.11142 14.5989 7.11971 14.5754ZM7.30486 17.2226C7.15735 17.2231 7.01299 17.1799 6.89005 17.0984C6.76712 17.0169 6.67115 16.9007 6.6143 16.7646C6.55745 16.6285 6.54228 16.4785 6.57071 16.3338C6.59914 16.1891 6.66989 16.056 6.77399 15.9515C6.8781 15.847 7.01089 15.7757 7.15552 15.7468C7.30016 15.7178 7.45014 15.7324 7.58647 15.7887C7.7228 15.8451 7.83934 15.9406 7.92134 16.0632C8.00333 16.1858 8.04708 16.33 8.04705 16.4776C8.04722 16.6747 7.96917 16.8639 7.83002 17.0035C7.69088 17.1432 7.50201 17.222 7.30486 17.2226ZM11.2796 16.8944C11.2717 16.929 11.2523 16.9599 11.2246 16.982C11.1969 17.0041 11.1625 17.0162 11.1271 17.0162H8.85393C8.81849 17.0161 8.78412 17.0041 8.75644 16.982C8.72875 16.9599 8.70941 16.929 8.70158 16.8944L8.52877 16.1288C8.52361 16.1059 8.52367 16.0822 8.52893 16.0593C8.5342 16.0365 8.54453 16.0151 8.55918 15.9968C8.57383 15.9785 8.59241 15.9637 8.61354 15.9536C8.63468 15.9434 8.65782 15.9382 8.68127 15.9382H11.2997C11.3232 15.9382 11.3463 15.9434 11.3674 15.9536C11.3886 15.9637 11.4071 15.9785 11.4218 15.9968C11.4364 16.0151 11.4468 16.0365 11.452 16.0593C11.4573 16.0822 11.4574 16.1059 11.4522 16.1288L11.2796 16.8944ZM12.6761 17.2226C12.5286 17.2232 12.3842 17.18 12.2613 17.0985C12.1383 17.017 12.0423 16.9008 11.9854 16.7647C11.9286 16.6286 11.9134 16.4787 11.9418 16.3339C11.9702 16.1891 12.0409 16.0561 12.145 15.9516C12.2491 15.847 12.3819 15.7758 12.5266 15.7468C12.6712 15.7178 12.8212 15.7324 12.9575 15.7887C13.0939 15.845 13.2104 15.9406 13.2924 16.0632C13.3744 16.1858 13.4182 16.33 13.4181 16.4776C13.4183 16.6747 13.3402 16.8638 13.2011 17.0034C13.062 17.1431 12.8732 17.2219 12.6761 17.2226Z" fill="#FCC042"/>
                        <path d="M12.1265 13.4299H7.85458L7.4877 14.4709H12.4932L12.1265 13.4299ZM7.30489 16.0448C7.2192 16.0442 7.13526 16.0691 7.06372 16.1162C6.99218 16.1634 6.93626 16.2308 6.90306 16.3098C6.86986 16.3888 6.86086 16.4759 6.87722 16.56C6.89358 16.6441 6.93455 16.7215 6.99494 16.7823C7.05533 16.8431 7.13241 16.8846 7.21642 16.9015C7.30043 16.9185 7.38757 16.9101 7.4668 16.8774C7.54603 16.8448 7.61378 16.7893 7.66145 16.7181C7.70913 16.6469 7.73458 16.5631 7.73458 16.4774C7.73483 16.3631 7.68973 16.2534 7.60918 16.1723C7.52863 16.0912 7.4192 16.0453 7.30489 16.0448ZM14.8454 14.3152V14.7465C14.8451 14.847 14.8086 14.944 14.7426 15.0198C14.6766 15.0955 14.5855 15.145 14.486 15.159L14.061 14.4059L13.8641 13.8965H14.4282C14.539 13.8968 14.6451 13.9411 14.7234 14.0196C14.8016 14.0981 14.8454 14.2044 14.8454 14.3152ZM6.11724 13.8965L5.92036 14.4059L5.49692 15.1574C5.39733 15.1439 5.30596 15.0949 5.23964 15.0194C5.17332 14.9439 5.13651 14.847 5.13599 14.7465V14.3152C5.13599 14.2603 5.14682 14.2058 5.16786 14.155C5.18891 14.1042 5.21975 14.058 5.25864 14.0191C5.29752 13.9803 5.34368 13.9494 5.39449 13.9284C5.44529 13.9073 5.49975 13.8965 5.55474 13.8965H6.11724Z" fill="#FCC042"/>
                        </g>
                        <defs>
                        <clipPath id="clip0_119_68">
                        <rect width="20" height="20" fill="white"/>
                        </clipPath>
                        </defs>
                    </svg>
                    Гаражные места:                            
                </p>
                <b>{selectCharData.maxcars}</b>
            </div>
            <div class="infoblock">
                <p>
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M12.9573 16.0783C12.9611 16.1692 12.9461 16.2599 12.9132 16.3447C12.8803 16.4295 12.8302 16.5065 12.7661 16.5711C12.6355 16.702 12.4583 16.7759 12.2733 16.7766H1.68424C1.59368 16.7768 1.50402 16.7587 1.42064 16.7234C1.33725 16.688 1.26186 16.6362 1.199 16.5711C1.13379 16.507 1.08249 16.4302 1.0483 16.3454C1.0141 16.2606 0.997745 16.1697 1.00025 16.0783C1.06175 12.8429 3.74371 10.2097 6.97917 10.2097C10.2146 10.2097 12.8966 12.8429 12.9573 16.0783ZM3.62071 6.18746C3.62071 4.42948 5.05694 3 6.81492 3C7.66128 3 8.47298 3.33622 9.07144 3.93468C9.66991 4.53315 10.0061 5.34485 10.0061 6.19121C10.0061 7.03757 9.66991 7.84926 9.07144 8.44773C8.47298 9.0462 7.66128 9.38241 6.81492 9.38241C5.96781 9.38162 5.15562 9.04475 4.55662 8.44575C3.95762 7.84676 3.62151 7.03457 3.62071 6.18746ZM11.2901 7.98668C11.2901 6.4942 12.5051 5.27922 13.9976 5.27922C15.4825 5.27922 16.6975 6.4942 16.6975 7.98668C16.6975 9.47166 15.4825 10.6866 13.9976 10.6866C12.5051 10.6866 11.2901 9.47166 11.2901 7.98668ZM19 16.0116C19 16.2141 18.925 16.4091 18.7825 16.5516C18.713 16.6224 18.6302 16.6788 18.5388 16.7174C18.4474 16.756 18.3492 16.7761 18.25 16.7766H14.3501C14.4326 16.5366 14.4626 16.2891 14.4551 16.0491C14.4232 14.3575 13.8146 12.7276 12.7301 11.4291C13.1801 11.2941 13.6526 11.2266 14.1251 11.2266C16.765 11.2266 18.955 13.3716 19 16.0116Z" fill="#FCC042"/>
                    </svg>                            
                    Жильцы:                            
                </p>
                <b>{residentsCount} / {replacements.find(r => selectCharData.houseType === r.word)?.replacement ?? selectCharData.houseType}</b>
            </div>
            <div class="infoblock">
                <p>
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M3.75 3.33325C3.06458 3.33325 2.5 3.89784 2.5 4.58325V17.9166C2.5 18.602 3.06458 19.1666 3.75 19.1666H11.25V16.6666C11.25 15.9812 11.8146 15.4166 12.5 15.4166H15V4.58325C15 3.89784 14.4354 3.33325 13.75 3.33325H3.75ZM5 6.24992H12.5C12.6105 6.24992 12.7165 6.29382 12.7946 6.37196C12.8728 6.4501 12.9167 6.55608 12.9167 6.66659C12.9167 6.77709 12.8728 6.88307 12.7946 6.96121C12.7165 7.03935 12.6105 7.08325 12.5 7.08325H5C4.88949 7.08325 4.78351 7.03935 4.70537 6.96121C4.62723 6.88307 4.58333 6.77709 4.58333 6.66659C4.58333 6.55608 4.62723 6.4501 4.70537 6.37196C4.78351 6.29382 4.88949 6.24992 5 6.24992ZM5 8.74992H12.5C12.6105 8.74992 12.7165 8.79382 12.7946 8.87196C12.8728 8.9501 12.9167 9.05608 12.9167 9.16659C12.9167 9.27709 12.8728 9.38307 12.7946 9.46121C12.7165 9.53935 12.6105 9.58325 12.5 9.58325H5C4.88949 9.58325 4.78351 9.53935 4.70537 9.46121C4.62723 9.38307 4.58333 9.27709 4.58333 9.16659C4.58333 9.05608 4.62723 8.9501 4.70537 8.87196C4.78351 8.79382 4.88949 8.74992 5 8.74992ZM5 11.2499H12.5C12.6105 11.2499 12.7165 11.2938 12.7946 11.372C12.8728 11.4501 12.9167 11.5561 12.9167 11.6666C12.9167 11.7771 12.8728 11.8831 12.7946 11.9612C12.7165 12.0394 12.6105 12.0833 12.5 12.0833H5C4.88949 12.0833 4.78351 12.0394 4.70537 11.9612C4.62723 11.8831 4.58333 11.7771 4.58333 11.6666C4.58333 11.5561 4.62723 11.4501 4.70537 11.372C4.78351 11.2938 4.88949 11.2499 5 11.2499ZM5 13.7499H10.1562C10.2668 13.7499 10.3727 13.7938 10.4509 13.872C10.529 13.9501 10.5729 14.0561 10.5729 14.1666C10.5729 14.2771 10.529 14.3831 10.4509 14.4612C10.3727 14.5394 10.2668 14.5833 10.1562 14.5833H5C4.88949 14.5833 4.78351 14.5394 4.70537 14.4612C4.62723 14.3831 4.58333 14.2771 4.58333 14.1666C4.58333 14.0561 4.62723 13.9501 4.70537 13.872C4.78351 13.7938 4.88949 13.7499 5 13.7499ZM12.5 16.2499C12.2621 16.2499 12.0833 16.4287 12.0833 16.6666V18.9416L14.8542 16.5666C14.8999 16.5275 14.9366 16.4789 14.9618 16.4242C14.987 16.3696 15 16.3101 15 16.2499H12.5Z" fill="#FCC042"/>
                        <path d="M6.25 0.833252C5.56458 0.833252 5 1.39784 5 2.08325V2.33159C5 2.44209 5.0439 2.54807 5.12204 2.62621C5.20018 2.70435 5.30616 2.74825 5.41667 2.74825C5.52717 2.74825 5.63315 2.70435 5.71129 2.62621C5.78943 2.54807 5.83333 2.44209 5.83333 2.33159V2.08325C5.83333 1.84534 6.01208 1.66659 6.25 1.66659H16.25C16.4879 1.66659 16.6667 1.84534 16.6667 2.08325V15.4166C16.6667 15.6545 16.4879 15.8333 16.25 15.8333H16.0917C15.9812 15.8333 15.8752 15.8772 15.797 15.9553C15.7189 16.0334 15.675 16.1394 15.675 16.2499C15.675 16.3604 15.7189 16.4664 15.797 16.5445C15.8752 16.6227 15.9812 16.6666 16.0917 16.6666H16.25C16.9354 16.6666 17.5 16.102 17.5 15.4166V2.08325C17.5 1.39784 16.9354 0.833252 16.25 0.833252H6.25Z" fill="#FCC042"/>
                    </svg>                            
                    Оплачено:                            
                </p>
                <b>{selectCharData.housePaid} дней</b>
            </div>
            {#if menuAccess.includes ("sell") && houseData && Object.values (houseData) && Object.values (houseData).length}
            <div class="btnsell" on:keypress={() => {}} on:click={() => onAction ("sell")}>
                <p>Продать</p>
            </div>
            {/if}
        </div>
    </div>
    <div class="rightmenu">
        <div class="headmenu">
            <h1>Жильцы</h1>
            <h1>{residentsCount} / {replacements.find(r => selectCharData.houseType === r.word)?.replacement ?? selectCharData.houseType}</h1>
        </div>
        <div class="blockjitel">
            <span>#</span>
            <p>Имя Фамилия</p>
            <p>Заселился</p>
        </div>
        {#each Object.keys (residentsData) as name, index}
            <div class="blockjitel">
                <span>{index + 1}</span>
                <p>{name.replace(/_/g, ' ')}</p>
                <p>{TimeFormat (residentsData [name].Date, "DD.MM.YYYY H:mm")}</p>
            </div>
        {/each}
    </div>
</div>