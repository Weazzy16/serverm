<script>
  import { accountRedbucks } from 'store/account';
  import { executeClient } from 'api/rage';
  import './cars.css';

  export let SetPopup;
  export let searchText = '';
  export let pagefilter;

  import { shopList } from './shopList.js';

  // Отсортированный список для главного каталога
  const sortFunctions = {
    12: (a, b) => a.price - b.price,
    13: (a, b) => b.price - a.price,
    14: (a, b) => a.line.localeCompare(b.line),
    15: (a, b) => b.line.localeCompare(a.line),
  };
  $: sortedShopList = [...shopList].sort(sortFunctions[pagefilter] || (() => 0));

  // Модель, выбранная в "Другие модели" или из каталога
  let selectedModel = null;
  let currentIndex = 0;
  let maxIndex = 0;
let otherModels = [];

  // Функция-утилита: перемешивает массив «на месте»
   function shuffle(arr) {
    for (let i = arr.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
  }

  const maxPrice = Math.max(...shopList.map(m => m.price));

  $: if (selectedModel) {
    const base = selectedModel.price;
    let eligible;

    if (base === maxPrice) {
      // для самой дорогой: -2…-5к
      eligible = shopList.filter(m =>
        m.price <= base - 2000 &&
        m.price >= base - 5000
      );
    } else {
      // для остальных: +2…+5к
      eligible = shopList.filter(m =>
        m.price >= base + 2000 &&
        m.price <= base + 5000
      );
    }

    // -- вот тут добавляем fallback: если мало ⇒ докидываем просто любые другие машины
    if (eligible.length < 4) {
      // исключаем из докидывашек уже попавшие и ту же модель
      const pool = shopList.filter(m =>
        m.title !== selectedModel.title &&
        !eligible.includes(m)
      );
      // берем из pool столько, сколько не хватает
      eligible = eligible.concat(shuffle(pool).slice(0, 4 - eligible.length));
    }

    otherModels = shuffle(eligible).slice(0, 4);
  } else {
    // до выбора — первые 4 любых
    otherModels = shopList.slice(0, 4);
  }

  function selectModel(model) {
    selectedModel = model;
    currentIndex = 0;
    maxIndex = model.list.length - 1;
    switchBlock();
    window.pageloadf2(0);
    window.pagenameitemf2(model.title);
    
  }

  function switchBlock() {
    const blocks = document.querySelectorAll('.blgf');
    blocks.forEach((block, idx) => {
      block.style.display = idx === currentIndex ? 'flex' : 'none';
    });
  }

  function nextBlock() {
    if (currentIndex < maxIndex) {
      currentIndex += 1;
      switchBlock();
    }
  }

  function prevBlock() {
    if (currentIndex > 0) {
      currentIndex -= 1;
      switchBlock();
    }
  }

  function onBuy(item) {
    if ($accountRedbucks < item.price) {
      return window.notificationAdd(4, 9, 'Недостаточно Redbucks!', 3000);
    }
    SetPopup();
    executeClient('client.donate.buy.clothes', item.id);
    window.notificationAdd(3, 9, 'Поздравляем с покупкой', 3000);
  }
   function buildRoute() {
    console.log('Построить маршрут для', selectedModel.title);
  }
  
</script>

{#if selectedModel}
  <div class="itemPage">
    <div class="content">
      <!-- HEADER -->
      <div class="header">
        <div class="title">{selectedModel.title}</div>
        <div class="price">
          {#if selectedModel.oldPrice}
            <div class="old-price">
              {selectedModel.oldPrice.toLocaleString('ru-RU')}
            </div>
          {/if}
          <div class="current-price">
            {selectedModel.price.toLocaleString('ru-RU')}
          </div>
          <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
<path class="back" d="M9.99931 19.1668C15.0619 19.1668 19.166 15.0628 19.166 10.0002C19.166 4.93755 15.0619 0.833496 9.99931 0.833496C4.9367 0.833496 0.832642 4.93755 0.832642 10.0002C0.832642 15.0628 4.9367 19.1668 9.99931 19.1668Z"/>
<path class="m" d="M8.2834 11.8721C8.05388 12.1028 7.89926 12.3974 7.83973 12.7173C7.83973 13.0271 7.99465 13.7971 8.42732 13.7971C8.70232 13.7971 9.23582 13.1875 9.40265 12.984C10.625 11.4209 12.0484 10.0259 13.6358 8.8352L13.6578 8.85628C12.8805 9.83162 11.4752 11.4339 11.4752 12.7173C11.4752 13.3379 11.7191 14.0116 12.4506 14.0116C13.4039 14.0116 15.7863 12.1939 16.0521 11.4559L16.0081 11.0499C14.5112 12.4496 13.6468 12.9309 13.3388 12.9309C13.073 12.9309 12.9511 12.621 12.9511 12.4065C13.1223 11.4878 13.5663 10.642 14.2252 9.9792L15.9431 7.96253C16.076 7.80212 16.4197 7.42812 16.4197 7.21362C16.4197 6.99912 15.9541 6.29695 15.6552 6.29695C15.4554 6.29695 15.2345 6.52153 15.0897 6.63887C13.6376 7.75078 12.3635 8.91678 11.0004 10.0498L10.9784 10.0287C11.4367 9.35495 12.6284 7.77187 12.6284 6.98078C12.615 6.7776 12.5231 6.58757 12.3723 6.45077C12.2215 6.31396 12.0234 6.24106 11.8199 6.24745C11.3616 6.25845 10.4238 7.06053 10.0141 7.43453L8.2504 9.07078L8.2284 9.0497C8.50398 8.44757 8.7338 7.82553 8.9159 7.18887C8.91064 7.0437 8.86457 6.90296 8.78298 6.78278L8.51715 6.33362C8.40623 6.15028 8.36223 6.00178 8.0964 5.9917C7.37449 6.16448 6.67343 6.41497 6.00548 6.73878L4.75332 7.2952L4.72215 7.27412C5.1539 6.90745 5.30973 6.7177 5.30973 6.65353C5.30973 6.58937 5.23182 6.54628 5.17682 6.54628C5.07498 6.57453 4.98093 6.62563 4.90182 6.6957C3.91548 7.36945 3.98515 7.34837 3.88248 7.4767C3.74234 7.88603 3.64646 8.30919 3.59648 8.73895C3.54148 8.99562 3.68815 9.13495 3.86232 9.13495C4.4279 9.13495 3.89532 9.11387 7.30898 7.57662C7.41662 7.51503 7.5337 7.47167 7.65548 7.44828C7.84432 7.44828 8.04323 7.66187 6.87998 9.67303L4.56082 12.4899C4.68273 12.8218 4.90457 13.666 5.36932 13.666C5.72407 13.666 6.0009 13.2599 6.18973 13.0134L7.85165 10.8564L10.51 8.0762C10.5879 7.99095 10.7208 7.85162 10.8537 7.85162C10.9866 7.85162 11.0196 7.96895 10.8317 8.30995C10.3221 9.2379 9.72082 10.1125 9.0369 10.9206L8.2834 11.8721Z"/>
</svg>
          {#if selectedModel.discount}
            <div class="discount">{selectedModel.discount}</div>
          {/if}
        </div>
        <button class="buildRoute" on:click={buildRoute}>
          ПОСТРОИТЬ МАРШРУТ
        </button>
      </div>

      <!-- MAIN ITEM CARD (слайдер превью) -->
      <div class="item item__rarity-{selectedModel.line}">
        <div class="item__rarity"><svg fill="none" viewBox="0 0 16 4" xmlns="http://www.w3.org/2000/svg">
  <path d="M14 0H2C0.89543 0 0 0.89543 0 2C0 3.10457 0.89543 4 2 4H14C15.1046 4 16 3.10457 16 2C16 0.89543 15.1046 0 14 0Z" fill="#8958FF"/>
</svg></div>
        <div class="item__rarity__radial-gradient"></div>
        <div class="swiper">
          {#each selectedModel.list as imgItem}
            <div
              class="swiper-slide__image"
              style="background-image: url({imgItem.img});"
            ></div>
          {/each}
        </div>
      </div>

      <!-- СПЕЦИФИКАЦИИ -->
       <div class="item__add-specifications">
    <!-- Багажник -->
    <div class="item__add-specifications__item">
      <div class="info">
        <div class="title">Багажник</div>
        <div class="percent">
          <span>{selectedModel.specifications.capacity} KG</span>
        </div>
      </div>
    </div>

    <!-- Бак -->
    <div class="item__add-specifications__item">
      <div class="info">
        <div class="title">Бак</div>
        <div class="percent">
          <span>{selectedModel.specifications.fuelCap} литры</span>
        </div>
      </div>
    </div>

    <!-- Тип топлива -->
    <div class="item__add-specifications__item">
      <div class="info">
        <div class="title">Тип топлива</div>
        <div class="percent">
          <span>{selectedModel.specifications.fuelType}</span>
        </div>
      </div>
    </div>
  </div>
      <div class="item__specifications">
        <div class="specification">
          <div class="info">
            <div class="icon">
            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="none">
	<path d="M8.50017 3.16663C4.82417 3.16663 1.8335 6.15729 1.8335 9.83329C1.83263 10.8622 2.07259 11.8771 2.53417 12.7966C2.6475 13.0233 2.87817 13.1666 3.13083 13.1666H13.8688C14.1215 13.1666 14.3528 13.0233 14.4662 12.7966C14.9277 11.8771 15.1677 10.8622 15.1668 9.83329C15.1668 6.15729 12.1762 3.16663 8.50017 3.16663ZM11.8482 6.51463L9.20683 10.54C9.13335 10.6522 9.03845 10.7488 8.92758 10.8243C8.8167 10.8998 8.69202 10.9527 8.56068 10.9799C8.42934 11.0072 8.29391 11.0083 8.16215 10.9831C8.03039 10.9579 7.90489 10.907 7.79283 10.8333C7.65102 10.7406 7.53454 10.6139 7.45392 10.4649C7.37331 10.3159 7.33109 10.1491 7.33109 9.97963C7.33109 9.81018 7.37331 9.6434 7.45392 9.49436C7.53454 9.34531 7.65102 9.2187 7.79283 9.12596L11.8182 6.48463C11.823 6.4816 11.8289 6.48061 11.8345 6.48185C11.8401 6.4831 11.845 6.48649 11.8482 6.49129C11.8503 6.49482 11.8514 6.49885 11.8514 6.50296C11.8514 6.50707 11.8503 6.5111 11.8482 6.51463Z"/>
</svg></div>
            <div class="title">Скорость</div>
            <div class="percent">
              {selectedModel.specifications.maxSpeed.toFixed(2)} км/ч
            </div>
          </div>
          <div class="progress">
            <div
              class="progress-value"
              style="width: {Math.round(selectedModel.specifications.maxSpeed / 222 * 100)}%"
            ></div>
          </div>
        </div>

        <div class="specification">
          <div class="info">
            <div class="icon">
            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="none">
	<path d="M8.95715 3.29272L7.54248 4.70739L10.8358 8.00006L7.54248 11.2927L8.95715 12.7074L13.6638 8.00006L8.95715 3.29272Z"/>
	<path d="M4.29064 12.7074L8.99731 8.00006L4.29064 3.29272L2.87598 4.70739L6.16931 8.00006L2.87598 11.2927L4.29064 12.7074Z"/>
</svg></div>
            <div class="title">Ускорение</div>
            <div class="percent">
              {(selectedModel.specifications.acceleration / 40 * 100).toFixed(2)} %
            </div>
          </div>
          <div class="progress">
            <div
              class="progress-value"
              style="width: {(selectedModel.specifications.acceleration / 40 * 100).toFixed(2)}%"
            ></div>
          </div>
        </div>

        <div class="specification">
          <div class="info">
            <div class="icon">
            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="none">
	<path d="M8.55134 3.26874C8.40135 3.26874 8.25311 3.27449 8.10662 3.28599V4.45291C8.10664 4.59035 8.05404 4.72257 7.95962 4.82243C7.8652 4.9223 7.73612 4.98221 7.5989 4.98988C6.83226 5.03243 6.10821 5.35614 5.56528 5.89907C5.02234 6.44201 4.69864 7.16605 4.65609 7.93269C4.64842 8.06991 4.5885 8.19899 4.48864 8.29341C4.38878 8.38784 4.25655 8.44044 4.11912 8.44041H2.95294C2.94144 8.58691 2.93569 8.73514 2.93569 8.88513C2.93584 9.99577 3.26532 11.0814 3.88247 12.0048C4.49961 12.9282 5.37671 13.6479 6.40285 14.0728C7.42899 14.4977 8.55808 14.6088 9.64736 14.392C10.7366 14.1753 11.7372 13.6404 12.5225 12.855C13.3078 12.0696 13.8425 11.069 14.0591 9.97967C14.2758 8.89036 14.1645 7.76128 13.7395 6.7352C13.3144 5.70912 12.5946 4.83211 11.6711 4.21509C10.7477 3.59807 9.66198 3.26874 8.55134 3.26874ZM10.9617 11.2932C10.4038 11.8511 9.66974 12.1982 8.8846 12.2755C8.09945 12.3527 7.31181 12.1554 6.65587 11.717C5.99993 11.2787 5.51627 10.6264 5.28732 9.87144C5.05836 9.11646 5.09826 8.30545 5.40023 7.57659C5.7022 6.84774 6.24756 6.24614 6.94336 5.87429C7.63917 5.50245 8.44239 5.38338 9.21615 5.53736C9.98991 5.69134 10.6863 6.10885 11.1868 6.71875C11.6872 7.32865 11.9607 8.0932 11.9606 8.88213C11.9618 9.33011 11.8741 9.77388 11.7027 10.1877C11.5312 10.6016 11.2794 10.9774 10.9617 11.2932Z"/>
	<path d="M8.55059 6.12831C8.00594 6.12831 7.47352 6.28981 7.02066 6.5924C6.56779 6.895 6.21482 7.32509 6.00639 7.82829C5.79795 8.33148 5.74342 8.88519 5.84968 9.41938C5.95594 9.95357 6.21821 10.4443 6.60334 10.8294C6.98847 11.2145 7.47916 11.4768 8.01335 11.583C8.54754 11.6893 9.10124 11.6348 9.60443 11.4263C10.1076 11.2179 10.5377 10.865 10.8403 10.4121C11.1429 9.95922 11.3044 9.42679 11.3044 8.88213C11.3034 8.15208 11.013 7.45221 10.4967 6.93598C9.98052 6.41975 9.28065 6.1293 8.55059 6.12831ZM8.55059 6.72377C8.61155 6.72377 8.67114 6.74186 8.72183 6.77573C8.77252 6.8096 8.81204 6.85773 8.83537 6.91405C8.8587 6.97038 8.8648 7.03235 8.8529 7.09214C8.84101 7.15193 8.81165 7.20686 8.76854 7.24996C8.72544 7.29307 8.67053 7.32241 8.61074 7.3343C8.55095 7.34619 8.48896 7.3401 8.43263 7.31677C8.37631 7.29344 8.32817 7.25394 8.29431 7.20325C8.26044 7.15256 8.24238 7.09295 8.24238 7.03199C8.24238 6.95024 8.27484 6.87184 8.33264 6.81404C8.39045 6.75623 8.46884 6.72377 8.55059 6.72377ZM6.6817 9.20912C6.62074 9.20912 6.56115 9.19103 6.51047 9.15716C6.45978 9.12329 6.42028 9.07516 6.39695 9.01883C6.37362 8.96251 6.3675 8.90054 6.37939 8.84075C6.39129 8.78096 6.42065 8.72603 6.46375 8.68293C6.50686 8.63982 6.56179 8.61046 6.62158 8.59857C6.68137 8.58667 6.74334 8.59279 6.79966 8.61612C6.85598 8.63945 6.90412 8.67895 6.93799 8.72964C6.97186 8.78033 6.98994 8.83991 6.98994 8.90088C6.98994 8.98262 6.95746 9.06102 6.89966 9.11883C6.84185 9.17663 6.76345 9.20912 6.6817 9.20912ZM8.55059 11.078C8.48963 11.078 8.43004 11.0599 8.37935 11.026C8.32866 10.9922 8.28916 10.944 8.26583 10.8877C8.24251 10.8314 8.23639 10.7694 8.24828 10.7096C8.26017 10.6498 8.28953 10.5949 8.33264 10.5518C8.37575 10.5087 8.43068 10.4793 8.49047 10.4675C8.55026 10.4556 8.61223 10.4617 8.66855 10.485C8.72487 10.5083 8.77301 10.5478 8.80688 10.5985C8.84075 10.6492 8.85883 10.7088 8.85883 10.7698C8.85883 10.8515 8.82635 10.9299 8.76854 10.9877C8.71074 11.0455 8.63234 11.078 8.55059 11.078ZM8.55059 9.86683C8.35599 9.86683 8.16575 9.80911 8.00394 9.701C7.84213 9.59288 7.71602 9.43921 7.64155 9.25942C7.56708 9.07963 7.54761 8.8818 7.58557 8.69094C7.62354 8.50007 7.71723 8.32474 7.85483 8.18713C7.99244 8.04952 8.16778 7.95581 8.35864 7.91784C8.54951 7.87988 8.74733 7.89938 8.92712 7.97385C9.10691 8.04832 9.26058 8.17443 9.3687 8.33624C9.47682 8.49804 9.53454 8.68828 9.53454 8.88289C9.53454 9.14384 9.43087 9.39412 9.24635 9.57864C9.06182 9.76317 8.81155 9.86683 8.55059 9.86683ZM10.7255 8.90088C10.7255 8.96184 10.7074 9.02145 10.6735 9.07214C10.6397 9.12283 10.5915 9.16233 10.5352 9.18566C10.4789 9.20898 10.4169 9.21508 10.3571 9.20319C10.2973 9.19129 10.2424 9.16193 10.1993 9.11883C10.1562 9.07572 10.1268 9.02081 10.1149 8.96102C10.103 8.90123 10.1091 8.83926 10.1325 8.78294C10.1558 8.72662 10.1953 8.67846 10.246 8.64459C10.2967 8.61072 10.3563 8.59266 10.4172 8.59266C10.458 8.59226 10.4984 8.59994 10.5361 8.61525C10.5739 8.63056 10.6082 8.65321 10.6371 8.68187C10.6661 8.71053 10.689 8.74464 10.7047 8.78223C10.7204 8.81982 10.7284 8.86015 10.7284 8.90088H10.7255Z"/>
	<path d="M2.37709 8.1097H4.11698C4.17052 8.1096 4.22201 8.08905 4.2609 8.05225C4.29979 8.01544 4.32316 7.96517 4.32622 7.91172C4.37512 7.06479 4.73384 6.26544 5.33405 5.66592C5.93427 5.0664 6.73403 4.7086 7.58101 4.66067C7.63499 4.65759 7.6857 4.6338 7.72258 4.59427C7.75946 4.55473 7.77967 4.5025 7.779 4.44843V2.70854C7.7791 2.68075 7.77367 2.65321 7.76301 2.62754C7.75235 2.60187 7.73669 2.57858 7.71693 2.55903C7.69717 2.53948 7.67371 2.52407 7.64793 2.51368C7.62215 2.5033 7.59456 2.49816 7.56676 2.49856H7.56226C6.14879 2.55305 4.80794 3.13895 3.80772 4.13917C2.8075 5.13939 2.22159 6.48024 2.1671 7.89372C2.16619 7.92182 2.17096 7.94982 2.18112 7.97604C2.19127 8.00226 2.20661 8.02616 2.22621 8.04632C2.24581 8.06648 2.26927 8.08249 2.29519 8.09338C2.32112 8.10427 2.34897 8.10982 2.37709 8.1097Z"/>
</svg></div>
            <div class="title">Торможение</div>
            <div class="percent">
              {(selectedModel.specifications.breaking / 3 * 100).toFixed(2)} %
            </div>
          </div>
          <div class="progress">
            <div
              class="progress-value"
              style="width: {(selectedModel.specifications.breaking / 3 * 100).toFixed(2)}%"
            ></div>
          </div>
        </div>

        <div class="specification">
          <div class="info">
            <div class="icon">
            <svg class="icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" fill="none">
	<path d="M7.41634 12.56L10.083 13.8V15.3333L6.08301 13.3333V9.33329H4.08301V6.66663H6.08301V2.66663L10.083 0.666626V2.19996L7.41634 3.43996V12.56ZM13.4163 6.66663H10.7497V3.60663L8.74967 4.53329V11.4666L10.7497 12.4V9.33329H13.4163V6.66663Z"/>
</svg></div>
            <div class="title">Сцепление</div>
            <div class="percent">
              {(selectedModel.specifications.traction / 3 * 100).toFixed(2)} %
            </div>
          </div>
          <div class="progress">
            <div
              class="progress-value"
              style="width: {(selectedModel.specifications.traction / 3 * 100).toFixed(2)}%"
            ></div>
          </div>
        </div>
      </div>

      <!-- БЛОК «ДРУГИЕ МОДЕЛИ» -->
      <div class="similar">
        <div class="title">Другие модели</div>
        <div class="items">
          {#each otherModels as model}
            <div class="similar-item" on:click={() => selectModel(model)}>
              <div class="award-card award-card__rarity-{model.line}">
                <div class="award-card__rarity"><svg fill="none" viewBox="0 0 16 4" xmlns="http://www.w3.org/2000/svg">
  <path d="M14 0H2C0.89543 0 0 0.89543 0 2C0 3.10457 0.89543 4 2 4H14C15.1046 4 16 3.10457 16 2C16 0.89543 15.1046 0 14 0Z" fill="#8958FF"/>
</svg></div>
                <div class="award-card__rarity__radial-gradient"></div>
                <img
                  class="award-card__media vehicle"
                  src={model.img}
                  alt={model.title}
                />
                <div class="award-card__price">
                  <div class="current-price">
                    {model.price.toLocaleString('ru-RU')}
                  </div>
                  <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
<path class="back" d="M9.99931 19.1668C15.0619 19.1668 19.166 15.0628 19.166 10.0002C19.166 4.93755 15.0619 0.833496 9.99931 0.833496C4.9367 0.833496 0.832642 4.93755 0.832642 10.0002C0.832642 15.0628 4.9367 19.1668 9.99931 19.1668Z"/>
<path class="m" d="M8.2834 11.8721C8.05388 12.1028 7.89926 12.3974 7.83973 12.7173C7.83973 13.0271 7.99465 13.7971 8.42732 13.7971C8.70232 13.7971 9.23582 13.1875 9.40265 12.984C10.625 11.4209 12.0484 10.0259 13.6358 8.8352L13.6578 8.85628C12.8805 9.83162 11.4752 11.4339 11.4752 12.7173C11.4752 13.3379 11.7191 14.0116 12.4506 14.0116C13.4039 14.0116 15.7863 12.1939 16.0521 11.4559L16.0081 11.0499C14.5112 12.4496 13.6468 12.9309 13.3388 12.9309C13.073 12.9309 12.9511 12.621 12.9511 12.4065C13.1223 11.4878 13.5663 10.642 14.2252 9.9792L15.9431 7.96253C16.076 7.80212 16.4197 7.42812 16.4197 7.21362C16.4197 6.99912 15.9541 6.29695 15.6552 6.29695C15.4554 6.29695 15.2345 6.52153 15.0897 6.63887C13.6376 7.75078 12.3635 8.91678 11.0004 10.0498L10.9784 10.0287C11.4367 9.35495 12.6284 7.77187 12.6284 6.98078C12.615 6.7776 12.5231 6.58757 12.3723 6.45077C12.2215 6.31396 12.0234 6.24106 11.8199 6.24745C11.3616 6.25845 10.4238 7.06053 10.0141 7.43453L8.2504 9.07078L8.2284 9.0497C8.50398 8.44757 8.7338 7.82553 8.9159 7.18887C8.91064 7.0437 8.86457 6.90296 8.78298 6.78278L8.51715 6.33362C8.40623 6.15028 8.36223 6.00178 8.0964 5.9917C7.37449 6.16448 6.67343 6.41497 6.00548 6.73878L4.75332 7.2952L4.72215 7.27412C5.1539 6.90745 5.30973 6.7177 5.30973 6.65353C5.30973 6.58937 5.23182 6.54628 5.17682 6.54628C5.07498 6.57453 4.98093 6.62563 4.90182 6.6957C3.91548 7.36945 3.98515 7.34837 3.88248 7.4767C3.74234 7.88603 3.64646 8.30919 3.59648 8.73895C3.54148 8.99562 3.68815 9.13495 3.86232 9.13495C4.4279 9.13495 3.89532 9.11387 7.30898 7.57662C7.41662 7.51503 7.5337 7.47167 7.65548 7.44828C7.84432 7.44828 8.04323 7.66187 6.87998 9.67303L4.56082 12.4899C4.68273 12.8218 4.90457 13.666 5.36932 13.666C5.72407 13.666 6.0009 13.2599 6.18973 13.0134L7.85165 10.8564L10.51 8.0762C10.5879 7.99095 10.7208 7.85162 10.8537 7.85162C10.9866 7.85162 11.0196 7.96895 10.8317 8.30995C10.3221 9.2379 9.72082 10.1125 9.0369 10.9206L8.2834 11.8721Z"/>
</svg>
                </div>
                <div class="award-card__info">
                  <div class="award-card__info-title">
                    {model.title}
                  </div>
                </div>
              </div>
            </div>
          {/each}
        </div>
      </div>
    </div>
  </div>


{:else}
  <!-- Главный каталог -->
 
  
      <div class="category">
        <div class="category__title">Автомобили</div>
        <div class="category__items">
          {#each sortedShopList as model}
            {#if !searchText || model.title.toLowerCase().includes(searchText.toLowerCase())}
              <div class="category__items-item" on:click={() => selectModel(model)}>
                <div class={`award-card award-card__rarity-${model.line}`}>
                  <div class="award-card__rarity">
                    <svg fill="none" viewBox="0 0 16 4" xmlns="http://www.w3.org/2000/svg">
  <path d="M14 0H2C0.89543 0 0 0.89543 0 2C0 3.10457 0.89543 4 2 4H14C15.1046 4 16 3.10457 16 2C16 0.89543 15.1046 0 14 0Z" fill="#8958FF"/>
</svg>
                  </div>
                  <div class="award-card__rarity__radial-gradient"></div>
            <img class="award-card__media vehicle" src="{model.img}" alt="{model.title}" />
                  <div class="award-card__price">
                    {#if model.oldPrice}
                      <div class="old-price">
                        {model.oldPrice.toLocaleString('ru-RU')}
                      </div>
                    {/if}
                    <div class="current-price">
                      {model.price.toLocaleString('ru-RU')}
                    </div>
                    <svg class="icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
<path class="back" d="M9.99931 19.1668C15.0619 19.1668 19.166 15.0628 19.166 10.0002C19.166 4.93755 15.0619 0.833496 9.99931 0.833496C4.9367 0.833496 0.832642 4.93755 0.832642 10.0002C0.832642 15.0628 4.9367 19.1668 9.99931 19.1668Z"/>
<path class="m" d="M8.2834 11.8721C8.05388 12.1028 7.89926 12.3974 7.83973 12.7173C7.83973 13.0271 7.99465 13.7971 8.42732 13.7971C8.70232 13.7971 9.23582 13.1875 9.40265 12.984C10.625 11.4209 12.0484 10.0259 13.6358 8.8352L13.6578 8.85628C12.8805 9.83162 11.4752 11.4339 11.4752 12.7173C11.4752 13.3379 11.7191 14.0116 12.4506 14.0116C13.4039 14.0116 15.7863 12.1939 16.0521 11.4559L16.0081 11.0499C14.5112 12.4496 13.6468 12.9309 13.3388 12.9309C13.073 12.9309 12.9511 12.621 12.9511 12.4065C13.1223 11.4878 13.5663 10.642 14.2252 9.9792L15.9431 7.96253C16.076 7.80212 16.4197 7.42812 16.4197 7.21362C16.4197 6.99912 15.9541 6.29695 15.6552 6.29695C15.4554 6.29695 15.2345 6.52153 15.0897 6.63887C13.6376 7.75078 12.3635 8.91678 11.0004 10.0498L10.9784 10.0287C11.4367 9.35495 12.6284 7.77187 12.6284 6.98078C12.615 6.7776 12.5231 6.58757 12.3723 6.45077C12.2215 6.31396 12.0234 6.24106 11.8199 6.24745C11.3616 6.25845 10.4238 7.06053 10.0141 7.43453L8.2504 9.07078L8.2284 9.0497C8.50398 8.44757 8.7338 7.82553 8.9159 7.18887C8.91064 7.0437 8.86457 6.90296 8.78298 6.78278L8.51715 6.33362C8.40623 6.15028 8.36223 6.00178 8.0964 5.9917C7.37449 6.16448 6.67343 6.41497 6.00548 6.73878L4.75332 7.2952L4.72215 7.27412C5.1539 6.90745 5.30973 6.7177 5.30973 6.65353C5.30973 6.58937 5.23182 6.54628 5.17682 6.54628C5.07498 6.57453 4.98093 6.62563 4.90182 6.6957C3.91548 7.36945 3.98515 7.34837 3.88248 7.4767C3.74234 7.88603 3.64646 8.30919 3.59648 8.73895C3.54148 8.99562 3.68815 9.13495 3.86232 9.13495C4.4279 9.13495 3.89532 9.11387 7.30898 7.57662C7.41662 7.51503 7.5337 7.47167 7.65548 7.44828C7.84432 7.44828 8.04323 7.66187 6.87998 9.67303L4.56082 12.4899C4.68273 12.8218 4.90457 13.666 5.36932 13.666C5.72407 13.666 6.0009 13.2599 6.18973 13.0134L7.85165 10.8564L10.51 8.0762C10.5879 7.99095 10.7208 7.85162 10.8537 7.85162C10.9866 7.85162 11.0196 7.96895 10.8317 8.30995C10.3221 9.2379 9.72082 10.1125 9.0369 10.9206L8.2834 11.8721Z"/>
</svg>
                  </div>
                  <div class="award-card__info">
                    {#if model.discount}
                      <div class="award-card__info-discount">
                        {model.discount}
                      </div>
                    {/if}
                    <div class="award-card__info-title">
                      {model.title}
                    </div>
                  </div>
                </div>
              </div>
            {/if}
          {/each}
        </div>
     
  </div>

{/if}
