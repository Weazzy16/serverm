<script>
    import { fly } from "svelte/transition";
    import RangeSlider from 'svelte-range-slider-pips';
    
    import "./style.scss";
    import { executeClient } from "api/rage";

    const path = "/src/views/eternal-dev/businesses/gas-station/images";

    // @ts-ignore
    require.context('./images/', true, /\.svg$/);

    export let viewData;

    let theme = "light",
        fuelInput = [0],

        station = {
            Company: "LimitedLtd",
            Id: 1,
            Street: "Street 1"
        },

        products = [
            { ItemId: 100, Name: "Набор инструментов", Price: 100, Weight: 200, Stock: 0 },
            { ItemId: 100, Name: "Набор инструментов", Price: 100, Weight: 200 },
            { ItemId: 100, Name: "Набор инструментов", Price: 100, Weight: 200 },
            { ItemId: 100, Name: "Набор инструментов", Price: 100, Weight: 200 },
        ],

        // carData = {
        //     MaxFuel: 120,
        //     CurrentFuel: 40,
        //     Model: "comet2",
        //     Name: "Pfhister Comet II",
        //     RecommendedFuel: "Regular",
        //     FuelSystem: 100
        // },

        carData = null,

        fuelTypes = [
            { Name: "regular", Price: 10, Active: true },
            { Name: "plus", Price: 10, Active: true },
            { Name: "premium", Price: 10, Active: true },
            { Name: "diesel", Price: 10, Active: true },
            { Name: "electro", Price: 10, Active: true },
        ],

        selectedType = -1,
        diagramFuel = `0 0`;

    const getDiagramFuel = (addFuel) => {
        const currentFuel = carData == null ? 1 : carData.CurrentFuel;
        const maxFuel = carData == null ? 1 : carData.MaxFuel;

        let t = 2 * Math.PI * 223.5;
        return `${t / 2 * (currentFuel + addFuel) / maxFuel} ${t}`
    }

    let animationFrameId = 0,
        isFilling = false,
        fuelFilled = 0,
        startTimestamp = void 0,
        animationFrameData = {
            initialValue: 0,
            duration: 0
        }

    // @ts-ignore
    window.gasStation_startAnimation = (count) => startFilling(count);

    const startFilling = (count) => {
        isFilling = true;
        const duration = 100 * count;

        animationFrameData = {
            duration,
            initialValue: count
        };

        animationFrameId = requestAnimationFrame(onAnimationFrame)
    }

    const clearAnimationFrame = () => {
        if (animationFrameId != void 0)
            cancelAnimationFrame(animationFrameId)

        animationFrameId = void 0
    }

    const onAnimationFrame = () => {
        if (startTimestamp == void 0)
            startTimestamp = Date.now();
        
        const { duration, initialValue } = animationFrameData;
        const time = Date.now() - startTimestamp;

        let value = initialValue * (1 - time / duration);

        if (value >= 0) {
            fuelInput[0] = Number(value.toFixed());
            animationFrameId = requestAnimationFrame(onAnimationFrame);
            fuelFilled = initialValue - fuelInput[0]
        }
        else {
            fuelInput[0] = 0,
            clearAnimationFrame(),
            startTimestamp = void 0,
            animationFrameData = {
                duration: 0,
                initialValue: 0
            },

            fuelFilled = initialValue - fuelInput[0];
            isFilling = false;
            executeClient("client.gas-station.end_filling")
        }
    }

    $: {
        selectedType = -1
        fuelInput[0] = 0
        fuelFilled = 0
        isFilling = false
    }

    $: if (viewData && typeof viewData === "string") {
        viewData = JSON.parse (viewData)

        theme = viewData.theme
        station = viewData.Station
        products = viewData.Products
        carData = viewData.CarData
        fuelTypes = viewData.FuelTypes
    }

    $: diagramFuel = getDiagramFuel(fuelFilled);
    $: totalPrice = selectedType == -1 ? 0 : fuelTypes[selectedType].Price * fuelInput[0];

    const onClick_selectFuelType = (index) => {
        selectedType = index;
    }

    const onClick_full = () => {
        if (carData == null) return;
        fuelInput[0] = carData.MaxFuel - carData.CurrentFuel;
    }

    const onClick_buyPetrol = (paymentType) => {
        if (isFilling) return;

        const data = fuelTypes[selectedType];
        if (data == null) return;

        executeClient("client.gas-station.buy_petrol", data.Name, fuelInput[0], paymentType);
    }

    const onClick_buyProduct = (index, paymentType) => {
        if (isFilling) return;

        const product = products[index];
        if (product == null) return;

        executeClient("client.gas-station.buy_product", product.Name, paymentType);
    }

    const onClick_close = () => {
        if (isFilling) return;
        executeClient("client.gas-station.close");
    }
</script>

<section in:fly={{ y: 500, duration: 300 }} out:fly={{ y: 500, duration: 300 }} class={ `gas-station ${theme} ${station.Company}` }
    style={ `background-image: url(${ path + `./images/${theme}/${station.Company}/header-background.svg` })` }>
    <div class="header">
        <div class="header-side">
            <div class="station">
                <img src={ path + `${theme}/${station.Company}/logo.svg` } alt="logo.svg"/> 
               <!-- <img src="http://cdn.piecerp.ru/src/views/player/gasStation/assets/images/logo.svg" alt="logo.svg"/>-->
                <div class="station-main">
                    <p>Заправка №{ station.Id }</p>
                    <div class="station-main__data">
                        <svg viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg" > <path d="M8 1.33325C5.05933 1.33325 2.66667 3.72592 2.66667 6.66325C2.64733 10.9599 7.79733 14.5226 8 14.6666C8 14.6666 13.3527 10.9599 13.3333 6.66659C13.3333 3.72592 10.9407 1.33325 8 1.33325ZM8 9.33325C6.52666 9.33325 5.33333 8.13992 5.33333 6.66659C5.33333 5.19325 6.52666 3.99992 8 3.99992C9.47333 3.99992 10.6667 5.19325 10.6667 6.66659C10.6667 8.13992 9.47333 9.33325 8 9.33325Z" ></path> </svg>
                        <p>{ station.Street }</p>
                    </div>
                </div>
            </div>
            {#if carData != null}
                <div class="header-side__car">
                    <p>Автомобиль:</p>
                    <p>{ carData.Name }</p>
                </div>
            {/if}
        </div>
        <div class={ `scale ${carData == null ? 'transparent' : ''}` }>
            <div class="scale-main">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 452 226" fill="none" ><g clip-path="url(#clip0_3038_32499)" ><circle cx="226" cy="226" r="223.5" transform="rotate(-180 226 226)" stroke-width="5" stroke-dasharray={ diagramFuel } ></circle><circle cx="226" cy="226" r="223.5" transform="rotate(-180 226 226)" stroke-width="5" ></circle></g ><defs ><clipPath id="clip0_3038_32499" ><rect width="452" height="226" fill="white" ></rect></clipPath ></defs ></svg>
            </div>
            <div class="scale-data">
                <div class="scale-data__main">
                    {#if selectedType == -1}
                        <div class="scale-data__main-type">
                            <p class="">{ carData == null ? 'Недоступно' :  'Выберите топливо' }</p>
                        </div>
                    {:else} 
                        <div class="scale-data__main-type">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" fill="none">
                                <path d="M1.75 4.66677C1.75 2.9508 3.31953 1.55566 5.25 1.55566H14C15.9305 1.55566 17.5 2.9508 17.5 4.66677V14.0001H17.9375C20.5953 14.0001 22.75 15.9154 22.75 18.2779V19.8334C22.75 20.48 23.3352 21.0001 24.0625 21.0001C24.7898 21.0001 25.375 20.48 25.375 19.8334V12.3473C23.8656 12.0022 22.75 10.7821 22.75 9.33344V6.22233L21 4.66677C20.5187 4.239 20.5187 3.539 21 3.11122C21.4813 2.68344 22.2687 2.68344 22.75 3.11122L26.9773 6.86886C27.6336 7.45219 28 8.24455 28 9.07094V19.8334C28 21.7682 26.2391 23.3334 24.0625 23.3334C21.8859 23.3334 20.125 21.7682 20.125 19.8334V18.2779C20.125 17.2036 19.1461 16.3334 17.9375 16.3334H17.5V23.3334C18.468 23.3334 19.25 24.0286 19.25 24.889C19.25 25.7494 18.468 26.4445 17.5 26.4445H1.75C0.782031 26.4445 0 25.7494 0 24.889C0 24.0286 0.782031 23.3334 1.75 23.3334V4.66677ZM5.25 5.44455V10.1112C5.25 10.539 5.64375 10.889 6.125 10.889H13.125C13.6063 10.889 14 10.539 14 10.1112V5.44455C14 5.01677 13.6063 4.66677 13.125 4.66677H6.125C5.64375 4.66677 5.25 5.01677 5.25 5.44455Z"></path>
                            </svg>
                            <p class="uppercase">{ fuelTypes[selectedType].Name }</p>
                        </div>

                        <p>${totalPrice}</p>
                    {/if}
                </div>
                <div class="scale-data__images">
                    <svg viewBox="0 0 9 12" fill="none" xmlns="http://www.w3.org/2000/svg" > <path d="M9 12H0V0H9V1.85307H2.30416V4.96552H8.86215V6.81859H2.30416V10.1469H9V12Z" ></path> </svg>
                    <img src={ 
                        carData == null 
                        ? `https://cdn.majestic-files.com/public/master/static/img/gasStation/${theme}/car.svg` 
                        : `https://cdn.majestic-files.com/public/master/static/img/vehicles/${carData.Model.toLowerCase()}.png` } alt="car.png" />
                        <!-- <img src="https://cdn.majestic-files.com/img/vehicles/g63.png" alt=""> -->
                    <svg viewBox="0 0 9 12" fill="none" xmlns="http://www.w3.org/2000/svg" > <path d="M2.30416 12H0V0H9V1.85307H2.30416V4.96552H8.86215V6.81859H2.30416V12Z" ></path> </svg>
                </div>
            </div>
        </div>
        <div class="header-side">
            <button on:click={() => onClick_close()} tabindex="-1" class="header-side__cross" >
                <svg viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg" > <path fill-rule="evenodd" clip-rule="evenodd" d="M7 8.42293L12.5771 14L14 12.5771L8.42293 7L14 1.42293L12.5771 0L7 5.57707L1.42293 0L0 1.42293L5.57707 7L0 12.5771L1.42293 14L7 8.42293Z" ></path> </svg>
            </button>
            { #if carData != null }
                <div class="data">
                    <div class="data-item">
                        <p>Состояние топливной системы:</p>
                        <div class="data-item__state">
                            <p>{ carData.FuelSystem }%</p>
                        </div>
                    </div>
                    <div class="data-item">
                        <p>Рекомендуемое топливо:</p>
                        <div class="data-item__state"> 
                            <p>{ carData.RecommendedFuel }</p>
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 28 28" fill="none" > <path d="M1.75 4.66677C1.75 2.9508 3.31953 1.55566 5.25 1.55566H14C15.9305 1.55566 17.5 2.9508 17.5 4.66677V14.0001H17.9375C20.5953 14.0001 22.75 15.9154 22.75 18.2779V19.8334C22.75 20.48 23.3352 21.0001 24.0625 21.0001C24.7898 21.0001 25.375 20.48 25.375 19.8334V12.3473C23.8656 12.0022 22.75 10.7821 22.75 9.33344V6.22233L21 4.66677C20.5187 4.239 20.5187 3.539 21 3.11122C21.4813 2.68344 22.2687 2.68344 22.75 3.11122L26.9773 6.86886C27.6336 7.45219 28 8.24455 28 9.07094V19.8334C28 21.7682 26.2391 23.3334 24.0625 23.3334C21.8859 23.3334 20.125 21.7682 20.125 19.8334V18.2779C20.125 17.2036 19.1461 16.3334 17.9375 16.3334H17.5V23.3334C18.468 23.3334 19.25 24.0286 19.25 24.889C19.25 25.7494 18.468 26.4445 17.5 26.4445H1.75C0.782031 26.4445 0 25.7494 0 24.889C0 24.0286 0.782031 23.3334 1.75 23.3334V4.66677ZM5.25 5.44455V10.1112C5.25 10.539 5.64375 10.889 6.125 10.889H13.125C13.6063 10.889 14 10.539 14 10.1112V5.44455C14 5.01677 13.6063 4.66677 13.125 4.66677H6.125C5.64375 4.66677 5.25 5.01677 5.25 5.44455Z" ></path> </svg>
                        </div>
                    </div>
                </div>
            {/if}
        </div>
    </div>
    <div class="content">
        <div class={ `content-wrapper ${carData == null ? 'transparent' : ''}` }>
            <div class="content-type">
                {#each fuelTypes as item, index }
                    <button on:click={() => onClick_selectFuelType(index)} class={ `type ${ item.Active ? 'stock' : 'absent' } ${selectedType == index ? 'selected' : ''}` }>
                        <div class="type-data">
                            <p>{ item.Name }</p>
                            <div class="type-data__price">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" > <path d="M12 24C18.6274 24 24 18.6274 24 12C24 5.37258 18.6274 0 12 0C5.37258 0 0 5.37258 0 12C0 18.6274 5.37258 24 12 24Z" ></path> <path d="M11.3263 18.3999V17.0727C9.62433 16.9449 8.24873 16.4336 7.19955 15.539L8.546 13.9464C9.3154 14.6346 10.2422 15.0573 11.3263 15.2146V12.8846C10.895 12.7962 10.5278 12.7126 10.2247 12.634C9.93325 12.5455 9.60101 12.4226 9.22797 12.2653C8.86659 12.0982 8.57515 11.9212 8.35365 11.7344C8.13216 11.5378 7.94564 11.2871 7.79409 10.9823C7.64254 10.6677 7.56677 10.3187 7.56677 9.93534C7.56677 9.16852 7.90484 8.50984 8.58098 7.9593C9.25711 7.39893 10.1722 7.06959 11.3263 6.97128V5.59985H12.9875V7.00077C14.3864 7.12858 15.5697 7.56606 16.5373 8.31322L15.1558 9.84686C14.5496 9.3848 13.8269 9.06529 12.9875 8.88833V10.9676C13.4189 11.0561 13.7861 11.1446 14.0892 11.233C14.3923 11.3215 14.7245 11.4493 15.0859 11.6164C15.4589 11.7737 15.7562 11.9507 15.9777 12.1473C16.2108 12.3439 16.4032 12.5995 16.5547 12.9141C16.7179 13.2189 16.7996 13.563 16.7996 13.9464C16.7996 14.7919 16.4731 15.4948 15.8203 16.0552C15.1675 16.6155 14.2232 16.9498 12.9875 17.0579V18.3999H11.3263ZM14.2815 14.1823C14.2815 13.7891 13.8502 13.4745 12.9875 13.2386V15.2146C13.3955 15.1458 13.7103 15.018 13.9318 14.8312C14.1649 14.6346 14.2815 14.4183 14.2815 14.1823ZM10.1023 9.75838C10.1023 10.1221 10.5103 10.4023 11.3263 10.5989V8.79985C10.9416 8.83918 10.6385 8.94732 10.417 9.12428C10.2072 9.2914 10.1023 9.50277 10.1023 9.75838Z" ></path> </svg>
                                <p>{ item.Price }</p>
                            </div>
                        </div>
                    </button>
                {/each}
            </div>
            <div class={ `content-action ${ carData != null && selectedType == -1 ? 'transparent' : '' }` }>
                <div class="action">
                    <div class="action-main">
                        <div class="action-main__part">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" > <path d="M12 24C18.6274 24 24 18.6274 24 12C24 5.37258 18.6274 0 12 0C5.37258 0 0 5.37258 0 12C0 18.6274 5.37258 24 12 24Z" ></path> <path d="M11.3263 18.3999V17.0727C9.62433 16.9449 8.24873 16.4336 7.19955 15.539L8.546 13.9464C9.3154 14.6346 10.2422 15.0573 11.3263 15.2146V12.8846C10.895 12.7962 10.5278 12.7126 10.2247 12.634C9.93325 12.5455 9.60101 12.4226 9.22797 12.2653C8.86659 12.0982 8.57515 11.9212 8.35365 11.7344C8.13216 11.5378 7.94564 11.2871 7.79409 10.9823C7.64254 10.6677 7.56677 10.3187 7.56677 9.93534C7.56677 9.16852 7.90484 8.50984 8.58098 7.9593C9.25711 7.39893 10.1722 7.06959 11.3263 6.97128V5.59985H12.9875V7.00077C14.3864 7.12858 15.5697 7.56606 16.5373 8.31322L15.1558 9.84686C14.5496 9.3848 13.8269 9.06529 12.9875 8.88833V10.9676C13.4189 11.0561 13.7861 11.1446 14.0892 11.233C14.3923 11.3215 14.7245 11.4493 15.0859 11.6164C15.4589 11.7737 15.7562 11.9507 15.9777 12.1473C16.2108 12.3439 16.4032 12.5995 16.5547 12.9141C16.7179 13.2189 16.7996 13.563 16.7996 13.9464C16.7996 14.7919 16.4731 15.4948 15.8203 16.0552C15.1675 16.6155 14.2232 16.9498 12.9875 17.0579V18.3999H11.3263ZM14.2815 14.1823C14.2815 13.7891 13.8502 13.4745 12.9875 13.2386V15.2146C13.3955 15.1458 13.7103 15.018 13.9318 14.8312C14.1649 14.6346 14.2815 14.4183 14.2815 14.1823ZM10.1023 9.75838C10.1023 10.1221 10.5103 10.4023 11.3263 10.5989V8.79985C10.9416 8.83918 10.6385 8.94732 10.417 9.12428C10.2072 9.2914 10.1023 9.50277 10.1023 9.75838Z" ></path> </svg>
                            <p>{ totalPrice }</p>
                        </div>
                        <div class="action-main__input">
                            <RangeSlider range="min" max={ carData == null ? 1 : carData.MaxFuel - carData.CurrentFuel } bind:values={fuelInput} />
                        </div>
                        <div class="action-main__part">
                            <div class="action-main__part-main">
                                <input bind:value={fuelInput[0]} type="text"/>
                                <p>{ selectedType == -1 ? '' : fuelTypes[selectedType].Name.toLowerCase() === 'electro' ? 'W.' : 'L' }</p>
                            </div>
                        </div>
                    </div>
                    <button on:click={onClick_full} tabindex="-1" class="action-button">Full</button>
                </div>
                <div class="content-action__buttons">
                    <button on:click={() => onClick_buyPetrol("Wallet")} tabindex="-1" class="content-action__buttons-item">
                        <svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" > <path d="M0.246267 9.02171C0.199914 9.03843 0.157315 9.06413 0.120908 9.09733C0.084502 9.13054 0.0550038 9.1706 0.0341033 9.21522C0.0132028 9.25984 0.00131067 9.30815 -0.000891985 9.35738C-0.00309464 9.4066 0.00443546 9.45578 0.021267 9.50209L0.256392 10.1501L2.05189 8.35571L0.246267 9.02171Z" ></path> <path d="M1.94391 14.7815L3.02391 17.7515C3.04066 17.7979 3.06651 17.8405 3.09992 17.8768C3.13334 17.9132 3.17366 17.9424 3.21853 17.963C3.2679 17.9859 3.32163 17.9977 3.37603 17.9979C3.42023 17.9979 3.46406 17.9899 3.50541 17.9742L4.69678 17.5344L1.94391 14.7815Z" ></path> <path d="M17.9785 12.2458L16.741 8.84717L13.7755 11.8104L15.2459 11.2693C15.3391 11.2348 15.4422 11.2388 15.5325 11.2804C15.6228 11.3219 15.6929 11.3977 15.7274 11.4909C15.7619 11.5842 15.7579 11.6873 15.7163 11.7776C15.6747 11.8679 15.599 11.938 15.5058 11.9724L13.6383 12.6609C13.5919 12.6779 13.5426 12.6856 13.4933 12.6835C13.4439 12.6814 13.3955 12.6695 13.3507 12.6486C13.306 12.6277 13.2658 12.5981 13.2325 12.5616C13.1992 12.5251 13.1735 12.4824 13.1568 12.4359C13.1568 12.4359 13.1568 12.4359 13.1568 12.4292L10.0135 15.578L17.7558 12.725C17.8019 12.7082 17.8442 12.6825 17.8804 12.6493C17.9165 12.6161 17.9458 12.5761 17.9665 12.5316C17.9872 12.4871 17.9989 12.4389 18.0009 12.3899C18.003 12.3408 17.9954 12.2919 17.9785 12.2458Z" ></path> <path d="M17.8885 6.10776L11.8912 0.110382C11.8208 0.0410602 11.7261 0.00219727 11.6273 0.00219727C11.5286 0.00219727 11.4338 0.0410602 11.3635 0.110382L0.113526 11.3604C0.0435213 11.4308 0.00422668 11.526 0.00422668 11.6253C0.00422668 11.7246 0.0435213 11.8199 0.113526 11.8903L6.1109 17.8854C6.14528 17.9208 6.18637 17.9489 6.23176 17.9682C6.27716 17.9876 6.32594 17.9976 6.37528 17.9979C6.47519 17.9971 6.57069 17.9566 6.64078 17.8854L17.8908 6.63538C17.9598 6.56478 17.9983 6.46984 17.9978 6.37111C17.9974 6.27237 17.9581 6.17777 17.8885 6.10776ZM4.38853 10.3884L2.89115 11.888C2.81889 11.9448 2.72831 11.9732 2.63655 11.9677C2.54479 11.9622 2.45822 11.9233 2.39322 11.8583C2.32822 11.7933 2.2893 11.7067 2.28383 11.615C2.27836 11.5232 2.30671 11.4326 2.36353 11.3604L3.8609 9.85851C3.93248 9.79489 4.02564 9.76101 4.12137 9.76377C4.21709 9.76654 4.30814 9.80575 4.37593 9.87339C4.44371 9.94103 4.48311 10.032 4.48608 10.1277C4.48905 10.2234 4.45536 10.3167 4.3919 10.3884H4.38853ZM10.864 10.8643C10.7277 10.9949 10.5666 11.097 10.3902 11.1644C10.2138 11.2318 10.0256 11.2633 9.8369 11.2569C9.03926 11.2065 8.29196 10.8497 7.75115 10.2613C7.29914 9.82324 6.97614 9.26946 6.8174 8.66038C6.73677 8.39992 6.7255 8.12292 6.78469 7.85677C6.84387 7.59061 6.97148 7.3445 7.1549 7.14276C7.35649 6.96223 7.60151 6.83715 7.86596 6.77977C8.13042 6.72238 8.40524 6.73465 8.66353 6.81538C9.2715 6.9755 9.82375 7.29969 10.2599 7.75251C11.3062 8.79201 11.5717 10.16 10.8674 10.8643H10.864ZM15.6385 6.63538L14.1412 8.13838C14.0696 8.202 13.9764 8.23588 13.8807 8.23312C13.785 8.23035 13.6939 8.19114 13.6261 8.1235C13.5583 8.05586 13.5189 7.96489 13.516 7.86917C13.513 7.77346 13.5467 7.68022 13.6102 7.60851L15.1098 6.10776C15.1819 6.04982 15.2729 6.02054 15.3653 6.02552C15.4577 6.0305 15.545 6.0694 15.6105 6.13475C15.676 6.2001 15.715 6.28732 15.7202 6.3797C15.7254 6.47208 15.6963 6.56312 15.6385 6.63538Z" ></path> </svg>
                        <p>Наличными</p>
                    </button>
                    <button on:click={() => onClick_buyPetrol("Bank")} tabindex="-1" class="content-action__buttons-item" >
                        <svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" > <path d="M16.92 3H1.08C0.793658 3.0003 0.519128 3.11418 0.316654 3.31665C0.114179 3.51913 0.000297808 3.79366 0 4.08L0 5.88H18V4.08C17.9997 3.79366 17.8858 3.51913 17.6833 3.31665C17.4809 3.11418 17.2063 3.0003 16.92 3Z" ></path> <path d="M0 14.1596C0.000297808 14.4459 0.114179 14.7204 0.316654 14.9229C0.519128 15.1254 0.793658 15.2393 1.08 15.2396H16.92C17.2063 15.2393 17.4809 15.1254 17.6833 14.9229C17.8858 14.7204 17.9997 14.4459 18 14.1596V8.03955H0V14.1596ZM3.24 10.1996H9.72C9.81548 10.1996 9.90705 10.2375 9.97456 10.305C10.0421 10.3725 10.08 10.4641 10.08 10.5596C10.08 10.655 10.0421 10.7466 9.97456 10.8141C9.90705 10.8816 9.81548 10.9196 9.72 10.9196H3.24C3.14452 10.9196 3.05295 10.8816 2.98544 10.8141C2.91793 10.7466 2.88 10.655 2.88 10.5596C2.88 10.4641 2.91793 10.3725 2.98544 10.305C3.05295 10.2375 3.14452 10.1996 3.24 10.1996ZM3.24 11.6396H6.84C6.88728 11.6396 6.93409 11.6489 6.97777 11.667C7.02144 11.685 7.06113 11.7116 7.09456 11.745C7.12799 11.7784 7.1545 11.8181 7.1726 11.8618C7.19069 11.9055 7.2 11.9523 7.2 11.9996C7.2 12.0468 7.19069 12.0936 7.1726 12.1373C7.1545 12.181 7.12799 12.2207 7.09456 12.2541C7.06113 12.2875 7.02144 12.3141 6.97777 12.3321C6.93409 12.3502 6.88728 12.3596 6.84 12.3596H3.24C3.19272 12.3596 3.14591 12.3502 3.10223 12.3321C3.05856 12.3141 3.01887 12.2875 2.98544 12.2541C2.95201 12.2207 2.92549 12.181 2.9074 12.1373C2.88931 12.0936 2.88 12.0468 2.88 11.9996C2.88 11.9523 2.88931 11.9055 2.9074 11.8618C2.92549 11.8181 2.95201 11.7784 2.98544 11.745C3.01887 11.7116 3.05856 11.685 3.10223 11.667C3.14591 11.6489 3.19272 11.6396 3.24 11.6396Z" ></path> </svg>
                        <p>По карте</p>
                    </button>
                </div>
            </div>
        </div>
        <div class="content-product">
            {#each products as item, index }
                <div class={ `product ${item.Stock <= 0 ? 'absent' : ''}` }>
                    <p>{ item.Name }</p>
                    <div class="product-main">
                        <img src={ document.cloud + `inventoryItems/items/${item.ItemId}.png` } alt="-10" />
                        <div class="product-main__data">
                            <div class="product-main__data-price">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" > <path d="M12 24C18.6274 24 24 18.6274 24 12C24 5.37258 18.6274 0 12 0C5.37258 0 0 5.37258 0 12C0 18.6274 5.37258 24 12 24Z" ></path> <path d="M11.3263 18.3999V17.0727C9.62433 16.9449 8.24873 16.4336 7.19955 15.539L8.546 13.9464C9.3154 14.6346 10.2422 15.0573 11.3263 15.2146V12.8846C10.895 12.7962 10.5278 12.7126 10.2247 12.634C9.93325 12.5455 9.60101 12.4226 9.22797 12.2653C8.86659 12.0982 8.57515 11.9212 8.35365 11.7344C8.13216 11.5378 7.94564 11.2871 7.79409 10.9823C7.64254 10.6677 7.56677 10.3187 7.56677 9.93534C7.56677 9.16852 7.90484 8.50984 8.58098 7.9593C9.25711 7.39893 10.1722 7.06959 11.3263 6.97128V5.59985H12.9875V7.00077C14.3864 7.12858 15.5697 7.56606 16.5373 8.31322L15.1558 9.84686C14.5496 9.3848 13.8269 9.06529 12.9875 8.88833V10.9676C13.4189 11.0561 13.7861 11.1446 14.0892 11.233C14.3923 11.3215 14.7245 11.4493 15.0859 11.6164C15.4589 11.7737 15.7562 11.9507 15.9777 12.1473C16.2108 12.3439 16.4032 12.5995 16.5547 12.9141C16.7179 13.2189 16.7996 13.563 16.7996 13.9464C16.7996 14.7919 16.4731 15.4948 15.8203 16.0552C15.1675 16.6155 14.2232 16.9498 12.9875 17.0579V18.3999H11.3263ZM14.2815 14.1823C14.2815 13.7891 13.8502 13.4745 12.9875 13.2386V15.2146C13.3955 15.1458 13.7103 15.018 13.9318 14.8312C14.1649 14.6346 14.2815 14.4183 14.2815 14.1823ZM10.1023 9.75838C10.1023 10.1221 10.5103 10.4023 11.3263 10.5989V8.79985C10.9416 8.83918 10.6385 8.94732 10.417 9.12428C10.2072 9.2914 10.1023 9.50277 10.1023 9.75838Z" ></path> </svg>
                                <p>{ item.Price }</p>
                            </div>
                            <div class="product-main__data-weight">
                                <p>{ (item.Weight / 1000).toFixed(2) }</p>
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 17 17" fill="none" > <rect width="17" height="17" rx="4"></rect> <path d="M8.23063 11.8249H6.48063L4.46063 9.15492L3.94063 9.77492V11.8249H2.52063V5.15492H3.94063V8.13492L6.30063 5.15492H8.05063L5.40063 8.28492L8.23063 11.8249Z" ></path> <path d="M11.6393 11.9549C10.6393 11.9549 9.79597 11.6349 9.1093 10.9949C8.4293 10.3549 8.0893 9.52159 8.0893 8.49492C8.0893 7.46159 8.4293 6.62826 9.1093 5.99492C9.79597 5.36159 10.6393 5.04492 11.6393 5.04492C12.8526 5.04492 13.7726 5.54159 14.3993 6.53492L13.2193 7.17492C13.0593 6.92159 12.8393 6.71492 12.5593 6.55492C12.286 6.38826 11.9793 6.30492 11.6393 6.30492C11.0326 6.30492 10.5326 6.51159 10.1393 6.92492C9.74597 7.33826 9.5493 7.86159 9.5493 8.49492C9.5493 9.12826 9.74597 9.65159 10.1393 10.0649C10.5326 10.4783 11.0326 10.6849 11.6393 10.6849C11.9193 10.6849 12.1893 10.6349 12.4493 10.5349C12.7093 10.4349 12.9126 10.3149 13.0593 10.1749V9.37492H11.2993V8.13492H14.4793V10.6949C13.726 11.5349 12.7793 11.9549 11.6393 11.9549Z" ></path> </svg>
                            </div>
                        </div>
                    </div>

                    {#if item.Stock <= 0}
                        <div class="product-popup">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                <path d="M12 5C7.589 5 4 8.589 4 13C4 17.411 7.589 21 12 21C16.411 21 20 17.411 20 13C20 8.589 16.411 5 12 5ZM13 13H11V8H13V13ZM9 2H15V4H9V2ZM18.707 4.293L20.707 6.293L19.293 7.707L17.293 5.707L18.707 4.293Z"></path>
                            </svg>
                            <p>Товар закончился</p>
                        </div>
                    {:else}
                        <div class="product-popup">
                            <button on:click={() => onClick_buyProduct(index, "Wallet")} class="product-popup__button">
                                <svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" > <path d="M0.246267 9.02171C0.199914 9.03843 0.157315 9.06413 0.120908 9.09733C0.084502 9.13054 0.0550038 9.1706 0.0341033 9.21522C0.0132028 9.25984 0.00131067 9.30815 -0.000891985 9.35738C-0.00309464 9.4066 0.00443546 9.45578 0.021267 9.50209L0.256392 10.1501L2.05189 8.35571L0.246267 9.02171Z" ></path> <path d="M1.94391 14.7815L3.02391 17.7515C3.04066 17.7979 3.06651 17.8405 3.09992 17.8768C3.13334 17.9132 3.17366 17.9424 3.21853 17.963C3.2679 17.9859 3.32163 17.9977 3.37603 17.9979C3.42023 17.9979 3.46406 17.9899 3.50541 17.9742L4.69678 17.5344L1.94391 14.7815Z" ></path> <path d="M17.9785 12.2458L16.741 8.84717L13.7755 11.8104L15.2459 11.2693C15.3391 11.2348 15.4422 11.2388 15.5325 11.2804C15.6228 11.3219 15.6929 11.3977 15.7274 11.4909C15.7619 11.5842 15.7579 11.6873 15.7163 11.7776C15.6747 11.8679 15.599 11.938 15.5058 11.9724L13.6383 12.6609C13.5919 12.6779 13.5426 12.6856 13.4933 12.6835C13.4439 12.6814 13.3955 12.6695 13.3507 12.6486C13.306 12.6277 13.2658 12.5981 13.2325 12.5616C13.1992 12.5251 13.1735 12.4824 13.1568 12.4359C13.1568 12.4359 13.1568 12.4359 13.1568 12.4292L10.0135 15.578L17.7558 12.725C17.8019 12.7082 17.8442 12.6825 17.8804 12.6493C17.9165 12.6161 17.9458 12.5761 17.9665 12.5316C17.9872 12.4871 17.9989 12.4389 18.0009 12.3899C18.003 12.3408 17.9954 12.2919 17.9785 12.2458Z" ></path> <path d="M17.8885 6.10776L11.8912 0.110382C11.8208 0.0410602 11.7261 0.00219727 11.6273 0.00219727C11.5286 0.00219727 11.4338 0.0410602 11.3635 0.110382L0.113526 11.3604C0.0435213 11.4308 0.00422668 11.526 0.00422668 11.6253C0.00422668 11.7246 0.0435213 11.8199 0.113526 11.8903L6.1109 17.8854C6.14528 17.9208 6.18637 17.9489 6.23176 17.9682C6.27716 17.9876 6.32594 17.9976 6.37528 17.9979C6.47519 17.9971 6.57069 17.9566 6.64078 17.8854L17.8908 6.63538C17.9598 6.56478 17.9983 6.46984 17.9978 6.37111C17.9974 6.27237 17.9581 6.17777 17.8885 6.10776ZM4.38853 10.3884L2.89115 11.888C2.81889 11.9448 2.72831 11.9732 2.63655 11.9677C2.54479 11.9622 2.45822 11.9233 2.39322 11.8583C2.32822 11.7933 2.2893 11.7067 2.28383 11.615C2.27836 11.5232 2.30671 11.4326 2.36353 11.3604L3.8609 9.85851C3.93248 9.79489 4.02564 9.76101 4.12137 9.76377C4.21709 9.76654 4.30814 9.80575 4.37593 9.87339C4.44371 9.94103 4.48311 10.032 4.48608 10.1277C4.48905 10.2234 4.45536 10.3167 4.3919 10.3884H4.38853ZM10.864 10.8643C10.7277 10.9949 10.5666 11.097 10.3902 11.1644C10.2138 11.2318 10.0256 11.2633 9.8369 11.2569C9.03926 11.2065 8.29196 10.8497 7.75115 10.2613C7.29914 9.82324 6.97614 9.26946 6.8174 8.66038C6.73677 8.39992 6.7255 8.12292 6.78469 7.85677C6.84387 7.59061 6.97148 7.3445 7.1549 7.14276C7.35649 6.96223 7.60151 6.83715 7.86596 6.77977C8.13042 6.72238 8.40524 6.73465 8.66353 6.81538C9.2715 6.9755 9.82375 7.29969 10.2599 7.75251C11.3062 8.79201 11.5717 10.16 10.8674 10.8643H10.864ZM15.6385 6.63538L14.1412 8.13838C14.0696 8.202 13.9764 8.23588 13.8807 8.23312C13.785 8.23035 13.6939 8.19114 13.6261 8.1235C13.5583 8.05586 13.5189 7.96489 13.516 7.86917C13.513 7.77346 13.5467 7.68022 13.6102 7.60851L15.1098 6.10776C15.1819 6.04982 15.2729 6.02054 15.3653 6.02552C15.4577 6.0305 15.545 6.0694 15.6105 6.13475C15.676 6.2001 15.715 6.28732 15.7202 6.3797C15.7254 6.47208 15.6963 6.56312 15.6385 6.63538Z" ></path> </svg>
                                <p>Наличными</p>
                            </button>
                            <button on:click={() => onClick_buyProduct(index, "Bank")} class="product-popup__button">
                                <svg viewBox="0 0 18 18" fill="none" xmlns="http://www.w3.org/2000/svg" > <path d="M16.92 3H1.08C0.793658 3.0003 0.519128 3.11418 0.316654 3.31665C0.114179 3.51913 0.000297808 3.79366 0 4.08L0 5.88H18V4.08C17.9997 3.79366 17.8858 3.51913 17.6833 3.31665C17.4809 3.11418 17.2063 3.0003 16.92 3Z" ></path> <path d="M0 14.1596C0.000297808 14.4459 0.114179 14.7204 0.316654 14.9229C0.519128 15.1254 0.793658 15.2393 1.08 15.2396H16.92C17.2063 15.2393 17.4809 15.1254 17.6833 14.9229C17.8858 14.7204 17.9997 14.4459 18 14.1596V8.03955H0V14.1596ZM3.24 10.1996H9.72C9.81548 10.1996 9.90705 10.2375 9.97456 10.305C10.0421 10.3725 10.08 10.4641 10.08 10.5596C10.08 10.655 10.0421 10.7466 9.97456 10.8141C9.90705 10.8816 9.81548 10.9196 9.72 10.9196H3.24C3.14452 10.9196 3.05295 10.8816 2.98544 10.8141C2.91793 10.7466 2.88 10.655 2.88 10.5596C2.88 10.4641 2.91793 10.3725 2.98544 10.305C3.05295 10.2375 3.14452 10.1996 3.24 10.1996ZM3.24 11.6396H6.84C6.88728 11.6396 6.93409 11.6489 6.97777 11.667C7.02144 11.685 7.06113 11.7116 7.09456 11.745C7.12799 11.7784 7.1545 11.8181 7.1726 11.8618C7.19069 11.9055 7.2 11.9523 7.2 11.9996C7.2 12.0468 7.19069 12.0936 7.1726 12.1373C7.1545 12.181 7.12799 12.2207 7.09456 12.2541C7.06113 12.2875 7.02144 12.3141 6.97777 12.3321C6.93409 12.3502 6.88728 12.3596 6.84 12.3596H3.24C3.19272 12.3596 3.14591 12.3502 3.10223 12.3321C3.05856 12.3141 3.01887 12.2875 2.98544 12.2541C2.95201 12.2207 2.92549 12.181 2.9074 12.1373C2.88931 12.0936 2.88 12.0468 2.88 11.9996C2.88 11.9523 2.88931 11.9055 2.9074 11.8618C2.92549 11.8181 2.95201 11.7784 2.98544 11.745C3.01887 11.7116 3.05856 11.685 3.10223 11.667C3.14591 11.6489 3.19272 11.6396 3.24 11.6396Z" ></path> </svg>
                                <p>По карте</p>
                            </button>
                        </div>
                    {/if}
                </div>
            {/each}
        </div>
    </div>
</section>
